<!-- build time:Mon Oct 17 2022 10:22:21 GMT+0000 (Coordinated Universal Time) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="xiaou博客" href="https://blog.xiaou.icu/rss.xml"><link rel="alternate" type="application/atom+xml" title="xiaou博客" href="https://blog.xiaou.icu/atom.xml"><link rel="alternate" type="application/json" title="xiaou博客" href="https://blog.xiaou.icu/feed.json"><link rel="stylesheet" href="//fonts.lug.ustc.edu.cn/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="java"><link rel="canonical" href="https://blog.xiaou.icu/springboot/Import%20%E6%B3%A8%E8%A7%A3/"><title>Import 注解 - springboot | xiaou = xiaou博客</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Import 注解</h1><div class="meta"><span class="item" title="创建时间：2022-03-12 17:43:09"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-03-12T17:43:09+08:00">2022-03-12</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>11k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>10 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">xiaou</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://s6.jpg.cm/2022/03/14/L2rkvh.png"></li><li class="item" data-background-image="https://s6.jpg.cm/2022/03/14/L2rat5.jpg"></li><li class="item" data-background-image="https://s6.jpg.cm/2022/03/14/L2EA8z.jpg"></li><li class="item" data-background-image="https://s6.jpg.cm/2022/03/14/L2sTkS.jpg"></li><li class="item" data-background-image="https://s6.jpg.cm/2022/03/14/L2rjEe.jpg"></li><li class="item" data-background-image="https://s6.jpg.cm/2022/03/14/L2E5Qe.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/springboot/" itemprop="item" rel="index" title="分类于 springboot"><span itemprop="name">springboot</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://blog.xiaou.icu/springboot/Import%20%E6%B3%A8%E8%A7%A3/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="xiaou"><meta itemprop="description" content=", xiaou博客"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="xiaou博客"></span><div class="body md" itemprop="articleBody"><h1 id="import-注解"><a class="anchor" href="#import-注解">#</a> Import 注解</h1><div class="note info"><p>@Import 注解可以用来批量导入需要注册的各种类是，如普通的类 / 配置的类 完成对普通类和配置类中所有 bean 的注册。</p></div><p>如果配置类在标准的 SpringBoot 包结构下 (SpringBootApplication 启动类包的根目录下)。是不需要 @Import 导入配置类的，SpringBoot 自动帮做了。上面的情况一般用于 @Configuration 配置类不在标准的 SpringBoot 包结构下面。所以一般在自定义 starter 的时候用到。</p><h2 id="import-源码"><a class="anchor" href="#import-源码">#</a> @Import 源码</h2><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token annotation punctuation">@Documented</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Import</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	 * &#123;@link Configuration @Configuration&#125;, &#123;@link ImportSelector&#125;,</pre></td></tr><tr><td data-num="8"></td><td><pre>	 * &#123;@link ImportBeanDefinitionRegistrar&#125;, or regular component classes to import.</pre></td></tr><tr><td data-num="9"></td><td><pre>	 */</pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><ol><li>@Import 可以使用在任何类型上，通常情况下，类和注解上用的比较多。</li><li>value：一个 Class 数组，设置需要导入的类，可以是 @Configuration 标注的列，可以是<br>ImportSelector 接口或者 ImportBeanDefinitionRegistrar 接口类型的，或者需要导入的普通组件<br>类。</li></ol></blockquote><h2 id="import-常见五种用法"><a class="anchor" href="#import-常见五种用法">#</a> @Import 常见五种用法</h2><ol><li>value 为普通的类</li><li>value 为 @Configuration 标注的类</li><li>value 为 @ComponentScan 标注的类</li><li>value 为 ImportBeanDefinitionRegistrar 接口类型</li><li>value 为 ImportSelector 接口类型</li><li>value 为 DeferredImportSelector 接口类型</li></ol><h2 id="实验1"><a class="anchor" href="#实验1">#</a> 实验 1</h2><h3 id="普通和配置类情况"><a class="anchor" href="#普通和配置类情况">#</a> 普通和配置类情况</h3><figure class="highlight java"><figcaption data-lang="java"><span>普通类</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Component</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ImportBean</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight java"><figcaption data-lang="java"><span>配置类</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Configuration</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ImportConfigBean</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token annotation punctuation">@Bean</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">module2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">return</span> <span class="token string">"我是配置类"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>importBean1<span class="token operator">-></span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springdemo<span class="token punctuation">.</span></span>ImportBean1</span><span class="token annotation punctuation">@196a42c3</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springdemo<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span>ImportConfigBean</span><span class="token operator">-></span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springdemo<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span>ImportConfigBean</span>$$<span class="token class-name">EnhancerBySpringCGLIB</span>$$<span class="token number">5f</span>fb1c43<span class="token annotation punctuation">@4c60d6e</span></pre></td></tr><tr><td data-num="3"></td><td><pre>module2<span class="token operator">-></span>我是配置类</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springdemo<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span>ImportBean</span><span class="token operator">-></span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springdemo<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span>ImportBean</span><span class="token annotation punctuation">@15043a2f</span></pre></td></tr></table></figure><p><strong>结果分析</strong></p><ol><li>ImportBean1 成功注入到容器中。bean 名称为完整的类名</li></ol><h3 id="导入-compontentscan-标注的类"><a class="anchor" href="#导入-compontentscan-标注的类">#</a> 导入 @CompontentScan 标注的类</h3><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IController</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Controller1</span> <span class="token keyword">implements</span> <span class="token class-name">IController</span><span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Controller2</span> <span class="token keyword">implements</span> <span class="token class-name">IController</span><span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    useDefaultFilters <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    includeFilters <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token annotation punctuation">@ComponentScan.Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span><span class="token constant">ASSIGNABLE_TYPE</span><span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token class-name">IController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScanBean1</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">ScanBean1</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ImportBean2</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight java"><figcaption data-lang="java"><span>测试类</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token function">importTest2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">AnnotationConfigApplicationContext</span> context <span class="token operator">=</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">ImportBean1</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> beanName <span class="token operator">:</span> context<span class="token punctuation">.</span><span class="token function">getBeanDefinitionNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>beanName <span class="token operator">+</span> <span class="token string">"->"</span> <span class="token operator">+</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>输出</strong></p><pre><code>importBean2-&gt;com.example.springdemo.ImportBean2@428640fa
controller1-&gt;com.example.springdemo.controller.Controller1@d9345cd
controller2-&gt;com.example.springdemo.controller.Controller2@2d710f1a
com.example.springdemo.ScanBean1-&gt;com.example.springdemo.ScanBean1@29215f06
</code></pre><h2 id="importbeandefinitionregistrar-接口"><a class="anchor" href="#importbeandefinitionregistrar-接口">#</a> ImportBeanDefinitionRegistrar 接口</h2><div class="note info"><p>这个接口提供了通过 Spring 容器 API 的方式直接向容器中注册 bean。</p></div><p>这个完整的名称</p><pre><code>org.springframework.context.annotation.ImportBeanDefinitionRegistrar
</code></pre><p>该接口的源码</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ImportBeanDefinitionRegistrar</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>   <span class="token keyword">default</span> <span class="token keyword">void</span> <span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="3"></td><td><pre>       <span class="token class-name">AnnotationMetadata</span> importingClassMetadata<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>         <span class="token class-name">BeanNameGenerator</span> importBeanNameGenerator<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span>importingClassMetadata<span class="token punctuation">,</span> registry<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>   <span class="token keyword">default</span> <span class="token keyword">void</span> <span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="9"></td><td><pre>       <span class="token class-name">AnnotationMetadata</span> importingClassMetadata<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol><li><strong>importingClassMetadata</strong>:<ul><li>AnnotationMetadata 类型的，通过这个可以获取被 @Import 注解标注的类所有注解的信息。</li></ul></li><li>registry<ul><li>BeanDefinitionRegistry 类型，是一个接口，内部提供了注册 bean 的各种方法。</li></ul></li><li>importBeanNameGenerator<ul><li>BeanNameGenerator 类型，是一个接口，内部有一个方法，用来生成 bean 的名称。</li></ul></li></ol><h3 id="beandefinitionregistry-接口bean-定义注册器"><a class="anchor" href="#beandefinitionregistry-接口bean-定义注册器">#</a> BeanDefinitionRegistry 接口：bean 定义注册器</h3><p>bean 定义注册器，提供了 bean 注册的各种方法，来看一下源码：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BeanDefinitionRegistry</span> <span class="token keyword">extends</span> <span class="token class-name">AliasRegistry</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="3"></td><td><pre>     * 注册一个新的 bean 定义</pre></td></tr><tr><td data-num="4"></td><td><pre>     * beanName：bean 的名称</pre></td></tr><tr><td data-num="5"></td><td><pre>     * beanDefinition：bean 定义信息</pre></td></tr><tr><td data-num="6"></td><td><pre>     */</pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span> beanDefinition<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="10"></td><td><pre>     * 通过 bean 名称移除已注册的 bean</pre></td></tr><tr><td data-num="11"></td><td><pre>     * beanName：bean 名称</pre></td></tr><tr><td data-num="12"></td><td><pre>     */</pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">removeBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token class-name">NoSuchBeanDefinitionException</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="16"></td><td><pre>     * 通过名称获取 bean 的定义信息</pre></td></tr><tr><td data-num="17"></td><td><pre>     * beanName：bean 名称</pre></td></tr><tr><td data-num="18"></td><td><pre>     */</pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token class-name">BeanDefinition</span> <span class="token function">getBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token class-name">NoSuchBeanDefinitionException</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="22"></td><td><pre>     * 查看 beanName 是否注册过</pre></td></tr><tr><td data-num="23"></td><td><pre>     */</pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">boolean</span> <span class="token function">containsBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="26"></td><td><pre>     * 获取已经定义（注册）的 bean 名称列表</pre></td></tr><tr><td data-num="27"></td><td><pre>     */</pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getBeanDefinitionNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="30"></td><td><pre>     * 返回注册器中已注册的 bean 数量</pre></td></tr><tr><td data-num="31"></td><td><pre>     */</pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token keyword">int</span> <span class="token function">getBeanDefinitionCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="34"></td><td><pre>     * 确定给定的 bean 名称或者别名是否已在此注册表中使用</pre></td></tr><tr><td data-num="35"></td><td><pre>     * beanName：可以是 bean 名称或者 bean 的别名</pre></td></tr><tr><td data-num="36"></td><td><pre>     */</pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token keyword">boolean</span> <span class="token function">isBeanNameInUse</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>基本上所有 bean 工厂都实现了这个接口，让 bean 工厂拥有 bean 注册的各种能力。</p><h3 id="beannamegenerator-接口bean-名称生成器"><a class="anchor" href="#beannamegenerator-接口bean-名称生成器">#</a> BeanNameGenerator 接口：bean 名称生成器</h3><p>bean 名称生成器，这个接口只有一个方法，用来生成 bean 的名称：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BeanNameGenerator</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token class-name">String</span> <span class="token function">generateBeanName</span><span class="token punctuation">(</span><span class="token class-name">BeanDefinition</span> definition<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>Spring 内置了 3 个实现。</p><h4 id="defaultbeannamegenerator"><a class="anchor" href="#defaultbeannamegenerator">#</a> DefaultBeanNameGenerator</h4><p>默认 bean 名称生成器，xml 中 bean 未指定名称的时候，默认就会使用这个生成器，默认为：完整的类名 #bean 编号。</p><h4 id="annotationbeannamegenerator"><a class="anchor" href="#annotationbeannamegenerator">#</a> AnnotationBeanNameGenerator</h4><p>注解方式的 bean 名称生成器，比如通过 @Component (bean 名称) 的方式指定 bean 名称，如果没有通过 注解方式指定名称，默认会将完整的类名作为 bean 名称。</p><h4 id="fullyqualifiedannotationbeannamegenerator"><a class="anchor" href="#fullyqualifiedannotationbeannamegenerator">#</a> FullyQualifiedAnnotationBeanNameGenerator</h4><p>将完整的类名作为 bean 的名称</p><h3 id="beandefinition接口bean定义信息"><a class="anchor" href="#beandefinition接口bean定义信息">#</a> BeanDefinition 接口：bean 定义信息</h3><p>用来表示 bean 定义信息的接口，我们向容器中注册 bean 之前，会通过 xml 或者其他方式定义 bean 的各种配置信息，bean 的所有配置信息都会被转换为一个 BeanDefinition 对象，然后通过容器中 BeanDefinitionRegistry 接口中的方法，将 BeanDefinition 注册到 Spring 容器中，完成 bean 的注册操作。</p><p>这个接口有很多实现类，有兴趣的可以去看看源码，BeanDefinition 的各种用法，以后会通过专题细 说。</p><h2 id="importbeandefinitionregistrar接口类型"><a class="anchor" href="#importbeandefinitionregistrar接口类型">#</a> ImportBeanDefinitionRegistrar 接口类型</h2><h3 id="步骤"><a class="anchor" href="#步骤">#</a> 步骤</h3><ol><li>定义 ImportBeanDefinitionRegistrar 接口实现类，在 registerBeanDefinitions 方法中使用 registry 来注册 bean</li><li>使用 @Import 来导入步骤 1 中定义的类</li><li>使用步骤 2 中 @Import 标注的类作为 AnnotationConfigApplicationContext 构造参数创建 spring 容器</li><li>使用 AnnotationConfigApplicationContext 操作 bean</li></ol><h3 id="实验"><a class="anchor" href="#实验">#</a> 实验</h3><ol><li><strong>ImportBeanDefinitionRegistrar 接口实现类</strong></li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyImportBeanDefinitionRegistrar</span> <span class="token keyword">implements</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token class-name">ImportBeanDefinitionRegistrar</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> importingClassMetadata<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>                                        <span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>                                        <span class="token class-name">BeanNameGenerator</span> importBeanNameGenerator<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">final</span> <span class="token class-name">AbstractBeanDefinition</span> beanDefinition <span class="token operator">=</span> <span class="token class-name">BeanDefinitionBuilder</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token punctuation">.</span><span class="token function">genericBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">BaseController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBeanDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        registry<span class="token punctuation">.</span><span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span><span class="token string">"baseController"</span><span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">final</span> <span class="token class-name">AbstractBeanDefinition</span> beanDefinition1 <span class="token operator">=</span> <span class="token class-name">BeanDefinitionBuilder</span><span class="token punctuation">.</span><span class="token function">genericBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">Base2Controller</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token punctuation">.</span><span class="token function">addPropertyReference</span><span class="token punctuation">(</span><span class="token string">"baseController"</span><span class="token punctuation">,</span> <span class="token string">"baseController"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token punctuation">.</span><span class="token function">getBeanDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        registry<span class="token punctuation">.</span><span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span><span class="token string">"base2Controller"</span><span class="token punctuation">,</span> beanDefinition1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="2"><li><strong>使用 @Import 来导入步骤 1 中定义的类</strong></li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">MyImportBeanDefinitionRegistrar</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ImportBean1</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="3"><li>测试方法</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">AnnotationConfigApplicationContext</span> context <span class="token operator">=</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">ImportBean1</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> beanName <span class="token operator">:</span> context<span class="token punctuation">.</span><span class="token function">getBeanDefinitionNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s->%s"</span><span class="token punctuation">,</span> beanName<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                                         context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>结果</strong></p><pre><code>importBean1-&gt;com.lean.springboot.ImportBean1@740fb309
baseController-&gt;com.lean.springboot.controller.BaseController@7bd7d6d6
base2Controller-&gt;Base2Controller&#123;baseController=com.lean.springboot.controller.BaseController@7bd7d6d6&#125;
</code></pre><h2 id="importselector-接口类型"><a class="anchor" href="#importselector-接口类型">#</a> ImportSelector 接口类型</h2><h3 id="接口源码"><a class="anchor" href="#接口源码">#</a> 接口源码</h3><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ImportSelector</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="3"></td><td><pre>     * 返回需要导入的类名的数组，可以是任何普通类，配置类（@Configuration、@Bean、</pre></td></tr><tr><td data-num="4"></td><td><pre>     *  @CompontentScan 等标注的类）</pre></td></tr><tr><td data-num="5"></td><td><pre>     * @importingClassMetadata：用来获取被 @Import 标注的类上面所有的注解信息</pre></td></tr><tr><td data-num="6"></td><td><pre>     */</pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">selectImports</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> importingClassMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="使用步骤"><a class="anchor" href="#使用步骤">#</a> 使用步骤</h3><ol><li>定义 ImportSelector 接口实现类，在 selectImports 返回需要导入的类的名称数组</li><li>使用 @Import 来导入步骤 1 中定义的类</li><li>使用步骤 2 中 @Import 标注的类作为 AnnotationConfigApplicationContext 构造参数创建 spring 容 器 4. 使用</li><li>使用 AnnotationConfigApplicationContext 操作 bean</li></ol><h3 id="实验-2"><a class="anchor" href="#实验-2">#</a> 实验</h3><ol><li>普通类</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BaseController</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="2"><li>配置类</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Configuration</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ImportDemoConfig</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token annotation punctuation">@Bean</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">return</span> <span class="token string">"xiaou"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="3"><li>定义 ImportSelector 接口实现类</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyImportSelector</span> <span class="token keyword">implements</span> <span class="token class-name">ImportSelector</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">selectImports</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> importingClassMetadata<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            <span class="token class-name">BaseController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token class-name">ImportDemoConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="4"><li>@Import 注解</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">MyImportSelector</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ImportBean2</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="5"><li>测试方法</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">AnnotationConfigApplicationContext</span> context <span class="token operator">=</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">ImportBean2</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> beanName <span class="token operator">:</span> context<span class="token punctuation">.</span><span class="token function">getBeanDefinitionNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s->%s"</span><span class="token punctuation">,</span> beanName<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                                         context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>结果</strong></p><pre><code>importBean2-&gt;com.lean.springboot.ImportBean2@2a7ed1f
com.lean.springboot.controller.BaseController-&gt;com.lean.springboot.controller.BaseController@3fa247d1
com.lean.springboot.configure.ImportDemoConfig-&gt;com.lean.springboot.configure.ImportDemoConfig$$EnhancerBySpringCGLIB$$6acd82fc@2cb2fc20
name-&gt;xiaou
</code></pre><blockquote><p>如果不想开启方法耗时统计，只需要将 @EnableMethodCostTime 去掉就可以 了，用起来是不是特别舒服。</p></blockquote><h2 id="deferredimportselector-接口"><a class="anchor" href="#deferredimportselector-接口">#</a> DeferredImportSelector 接口</h2><p>DeferredImportSelector 是 ImportSelector 的子接口，既然是 ImportSelector 的子接口，所以也可以通 过 @Import 进行导入，这个接口和 ImportSelector 不同地方有两点：</p><ol><li>延迟导入</li><li>指定导入的类的处理顺序</li></ol><h3 id="延迟导入"><a class="anchor" href="#延迟导入">#</a> 延迟导入</h3><p>比如 @Import 的 value 包含了多个普通类、多个 @Configuration 标注的配置类、多个 ImportSelector 接 口的实现类，多个 ImportBeanDefinitionRegistrar 接口的实现类，还有 DeferredImportSelector 接口实 现类，此时 spring 处理这些被导入的类的时候，<strong>会将 DeferredImportSelector 类型的放在最后处理， 会先处理其他被导入的类，其他类会按照 value 所在的前后顺序进行处理</strong>。</p><h2 id="自定义耗时注解"><a class="anchor" href="#自定义耗时注解">#</a> 自定义耗时注解</h2><h3 id="需求"><a class="anchor" href="#需求">#</a> 需求</h3><p>凡是类名中包含 service 的，调用他们内部任何方法，我们希望调用之后能够输出这些方法的耗时。</p><h3 id="分析"><a class="anchor" href="#分析">#</a> 分析</h3><ol><li>创建一个代理类，通过代理来间接访问需要统计耗时的 bean 对象</li><li>拦截 bean 的创建，给 bean 实例生成代理生成代理</li></ol><h3 id="实现"><a class="anchor" href="#实现">#</a> 实现</h3><ol><li>service</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Component</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Service2</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">m2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-> m2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Component</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Service1</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">m1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-> m1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="2"><li>CGLIB 代理类</li></ol><blockquote><p>统计耗时的代理类</p></blockquote><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CostTimeProxy</span> <span class="token keyword">implements</span> <span class="token class-name">MethodInterceptor</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">Object</span> target<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">CostTimeProxy</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>                            <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> objects<span class="token punctuation">,</span> <span class="token class-name">MethodProxy</span> methodProxy<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">long</span> starTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token comment">// 调用被代理对象（即 target）的方法，获取结果</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token class-name">Object</span> result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> objects<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>method <span class="token operator">+</span> <span class="token string">"，耗时(纳秒)："</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> starTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">return</span> result<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="20"></td><td><pre>     * 创建任意类的代理对象</pre></td></tr><tr><td data-num="21"></td><td><pre>     *</pre></td></tr><tr><td data-num="22"></td><td><pre>     * @param target</pre></td></tr><tr><td data-num="23"></td><td><pre>     * @param &lt;T></pre></td></tr><tr><td data-num="24"></td><td><pre>     * @return</pre></td></tr><tr><td data-num="25"></td><td><pre>     */</pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token class-name">T</span> <span class="token function">createProxy</span><span class="token punctuation">(</span><span class="token class-name">T</span> target<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token class-name">CostTimeProxy</span> costTimeProxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CostTimeProxy</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token class-name">Enhancer</span> enhancer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Enhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        enhancer<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span>costTimeProxy<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        enhancer<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> enhancer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="3"><li>拦截 bean 实例的创建，返回代理对象</li></ol><p><code>BeanPostProcessor</code> 这个接口是 bean 处理器，内部有 2 个方法，分别在 bean 初始化前后会进行调用，以后讲声明周期的时候 还会细说的，这里你只需要知道 bean 初始化之后会调用 postProcessAfterInitialization 方法就 行，这个方法中我们会给 bean 创建一个代理对象。</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MethodCostTimeProxyBeanPostProcessor</span> <span class="token keyword">implements</span> <span class="token class-name">BeanPostProcessor</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessAfterInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>                        <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>beanName<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"service"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token keyword">return</span> <span class="token class-name">CostTimeProxy</span><span class="token punctuation">.</span><span class="token function">createProxy</span><span class="token punctuation">(</span>bean<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">return</span> bean<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="4"><li>通过 @Import 结合 ImportSelector 的方式来导入刚刚创建拦截 bean 实例的类</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MethodCostTimeImportSelector</span> <span class="token keyword">implements</span> <span class="token class-name">ImportSelector</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">selectImports</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> importingClassMetadata<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>                <span class="token class-name">MethodCostTimeProxyBeanPostProcessor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="5"><li>定义 <code>@EnableMethodCostTime</code></li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">MethodCostTimeImportSelector</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">EnableMethodCostTime</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="6"><li>扫描类</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">"com.lean.springboot.service"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token annotation punctuation">@EnableMethodCostTime</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ImportBean3</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="7"><li>测试类</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">AnnotationConfigApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">ImportBean3</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token class-name">Service1</span> service1 <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">Service1</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token class-name">Service2</span> service2 <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">Service2</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    service1<span class="token punctuation">.</span><span class="token function">m1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    service2<span class="token punctuation">.</span><span class="token function">m2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>测试输出</strong></p><pre><code>class com.lean.springboot.service.Service1-&gt; m1
public void com.lean.springboot.service.Service1.m1()，耗时(纳秒)：174000
class com.lean.springboot.service.Service2-&gt; m2
public void com.lean.springboot.service.Service2.m2()，耗时(纳秒)：49200
</code></pre><div class="tags"><a href="/tags/java/" rel="tag"><i class="ic i-tag"></i> java</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-10-17 18:21:27" itemprop="dateModified" datetime="2022-10-17T18:21:27+08:00">2022-10-17</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="xiaou 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="xiaou 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>xiaou <i class="ic i-at"><em>@</em></i>xiaou博客</li><li class="link"><strong>本文链接：</strong> <a href="https://blog.xiaou.icu/springboot/Import%20%E6%B3%A8%E8%A7%A3/" title="Import 注解">https://blog.xiaou.icu/springboot/Import 注解/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/mysql/SQL%20%E4%B8%AD%E5%B0%86%E6%9D%A1%E4%BB%B6%E6%94%BE%E5%9C%A8%20on%20%E5%90%8E%E9%9D%A2%E4%B8%8E%20where%20%E5%90%8E%E9%9D%A2%E7%9A%84%E5%8C%BA%E5%88%AB/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;s6.jpg.cm&#x2F;2022&#x2F;03&#x2F;14&#x2F;L2rYJ6.jpg" title="SQL 中将条件放在 on 后面与 where 后面的区别"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> mysql</span><h3>SQL 中将条件放在 on 后面与 where 后面的区别</h3></a></div><div class="item right"><a href="/springboot/ComponentScan%20%E6%B3%A8%E8%A7%A3/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;s6.jpg.cm&#x2F;2022&#x2F;03&#x2F;14&#x2F;L2sexh.jpg" title="ComponentScan 注解"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> springboot</span><h3>ComponentScan 注解</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#import-%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.</span> <span class="toc-text">Import 注解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#import-%E6%BA%90%E7%A0%81"><span class="toc-number">1.1.</span> <span class="toc-text">@Import 源码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#import-%E5%B8%B8%E8%A7%81%E4%BA%94%E7%A7%8D%E7%94%A8%E6%B3%95"><span class="toc-number">1.2.</span> <span class="toc-text">@Import 常见五种用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C1"><span class="toc-number">1.3.</span> <span class="toc-text">实验 1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E5%92%8C%E9%85%8D%E7%BD%AE%E7%B1%BB%E6%83%85%E5%86%B5"><span class="toc-number">1.3.1.</span> <span class="toc-text">普通和配置类情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5-compontentscan-%E6%A0%87%E6%B3%A8%E7%9A%84%E7%B1%BB"><span class="toc-number">1.3.2.</span> <span class="toc-text">导入 @CompontentScan 标注的类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#importbeandefinitionregistrar-%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.4.</span> <span class="toc-text">ImportBeanDefinitionRegistrar 接口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#beandefinitionregistry-%E6%8E%A5%E5%8F%A3bean-%E5%AE%9A%E4%B9%89%E6%B3%A8%E5%86%8C%E5%99%A8"><span class="toc-number">1.4.1.</span> <span class="toc-text">BeanDefinitionRegistry 接口：bean 定义注册器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#beannamegenerator-%E6%8E%A5%E5%8F%A3bean-%E5%90%8D%E7%A7%B0%E7%94%9F%E6%88%90%E5%99%A8"><span class="toc-number">1.4.2.</span> <span class="toc-text">BeanNameGenerator 接口：bean 名称生成器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#defaultbeannamegenerator"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">DefaultBeanNameGenerator</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#annotationbeannamegenerator"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">AnnotationBeanNameGenerator</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fullyqualifiedannotationbeannamegenerator"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">FullyQualifiedAnnotationBeanNameGenerator</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#beandefinition%E6%8E%A5%E5%8F%A3bean%E5%AE%9A%E4%B9%89%E4%BF%A1%E6%81%AF"><span class="toc-number">1.4.3.</span> <span class="toc-text">BeanDefinition 接口：bean 定义信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#importbeandefinitionregistrar%E6%8E%A5%E5%8F%A3%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.5.</span> <span class="toc-text">ImportBeanDefinitionRegistrar 接口类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.5.1.</span> <span class="toc-text">步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C"><span class="toc-number">1.5.2.</span> <span class="toc-text">实验</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#importselector-%E6%8E%A5%E5%8F%A3%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.6.</span> <span class="toc-text">ImportSelector 接口类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E6%BA%90%E7%A0%81"><span class="toc-number">1.6.1.</span> <span class="toc-text">接口源码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.6.2.</span> <span class="toc-text">使用步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C-2"><span class="toc-number">1.6.3.</span> <span class="toc-text">实验</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#deferredimportselector-%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.7.</span> <span class="toc-text">DeferredImportSelector 接口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%B6%E8%BF%9F%E5%AF%BC%E5%85%A5"><span class="toc-number">1.7.1.</span> <span class="toc-text">延迟导入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%80%97%E6%97%B6%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.8.</span> <span class="toc-text">自定义耗时注解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82"><span class="toc-number">1.8.1.</span> <span class="toc-text">需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%9E%90"><span class="toc-number">1.8.2.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.8.3.</span> <span class="toc-text">实现</span></a></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/springboot/SpringBootApplication%E5%88%86%E6%9E%90/" rel="bookmark" title="SpringBootApplication分析">SpringBootApplication分析</a></li><li><a href="/springboot/SpringMVC%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E6%A6%82%E8%A7%88/" rel="bookmark" title="SpringBoot自动配置概览">SpringBoot自动配置概览</a></li><li><a href="/springboot/SpringBoot%20%E6%B3%A8%E8%A7%A3%E5%8A%9F%E8%83%BD/" rel="bookmark" title="SpringBoot 注解功能">SpringBoot 注解功能</a></li><li><a href="/springboot/FactoryBean%20%E5%92%8C%20BeanFactory/" rel="bookmark" title="FactoryBean 和 BeanFactory">FactoryBean 和 BeanFactory</a></li><li><a href="/springboot/Spring%20Bean%20%E4%BD%9C%E7%94%A8%E5%9F%9F/" rel="bookmark" title="Spring Bean 作用域">Spring Bean 作用域</a></li><li><a href="/springboot/Spring%20%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81/" rel="bookmark" title="Spring 消息推送">Spring 消息推送</a></li><li class="active"><a href="/springboot/Import%20%E6%B3%A8%E8%A7%A3/" rel="bookmark" title="Import 注解">Import 注解</a></li><li><a href="/springboot/ComponentScan%20%E6%B3%A8%E8%A7%A3/" rel="bookmark" title="ComponentScan 注解">ComponentScan 注解</a></li><li><a href="/springboot/Spring%20Bean%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/" rel="bookmark" title="Spring Bean 生命周期">Spring Bean 生命周期</a></li><li><a href="/springboot/Spring%20Value%20%E6%B3%A8%E8%A7%A3%E5%8A%A8%E6%80%81%E5%88%B7%E6%96%B0/" rel="bookmark" title="Spring Value 注解动态刷新">Spring Value 注解动态刷新</a></li><li><a href="/springboot/Spring%20%E4%BA%8B%E4%BB%B6%E6%A8%A1%E5%BC%8F/" rel="bookmark" title="Spring 事件模式">Spring 事件模式</a></li><li><a href="/springboot/Spring%20Bean%20%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96/" rel="bookmark" title="Spring Bean 循环依赖">Spring Bean 循环依赖</a></li><li><a href="/springboot/BeanFactory%E6%89%A9%E5%B1%95/" rel="bookmark" title="BeanFactory 扩展">BeanFactory 扩展</a></li><li><a href="/springboot/%E5%BC%82%E5%B8%B8%E9%80%9A%E7%9F%A5%E5%A4%84%E7%90%86%E5%92%8C%E8%BF%94%E5%9B%9E%E5%80%BC%E7%BB%9F%E4%B8%80%E5%B0%81%E8%A3%85/" rel="bookmark" title="异常通知处理和返回值统一封装">异常通知处理和返回值统一封装</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="xiaou" data-src="/images/avatar.jpg"><p class="name" itemprop="name">xiaou</p><div class="description" itemprop="description">xiaou博客</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">85</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">16</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">7</span> <span class="name">标签</span></a></div></nav><div class="social"></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/mysql/SQL%20%E4%B8%AD%E5%B0%86%E6%9D%A1%E4%BB%B6%E6%94%BE%E5%9C%A8%20on%20%E5%90%8E%E9%9D%A2%E4%B8%8E%20where%20%E5%90%8E%E9%9D%A2%E7%9A%84%E5%8C%BA%E5%88%AB/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/springboot/ComponentScan%20%E6%B3%A8%E8%A7%A3/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/MySql/" title="分类于 mysql">mysql</a></div><span><a href="/mysql/%E7%B4%A2%E5%BC%95/" title="索引">索引</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/desinMode/" title="分类于 desinMode">desinMode</a></div><span><a href="/designMode/%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8F/" title="解释器模式">解释器模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/JVM/" title="分类于 JVM">JVM</a></div><span><a href="/JVM/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B8%B8%E9%87%8F%E6%B1%A0/" title="字符串常量池">字符串常量池</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/desinMode/" title="分类于 desinMode">desinMode</a></div><span><a href="/designMode/%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F/" title="享元模式">享元模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java-%E6%A1%86%E6%9E%B6/" title="分类于 javaFrame">javaFrame</a></div><span><a href="/javaFrame/AOP%20%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/" title="AOP 实现原理">AOP 实现原理</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/data-structure/" title="分类于 数据结构">数据结构</a> <i class="ic i-angle-right"></i> <a href="/categories/data-structure/tree/" title="分类于 树">树</a></div><span><a href="/data_structure/BTree/" title="B树">B树</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/desinMode/" title="分类于 desinMode">desinMode</a></div><span><a href="/designMode/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/" title="代理模式">代理模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/data-structure/" title="分类于 数据结构">数据结构</a></div><span><a href="/data_structure/StringMatch/" title="字符串匹配算法">字符串匹配算法</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java-%E6%A1%86%E6%9E%B6/" title="分类于 javaFrame">javaFrame</a></div><span><a href="/javaFrame/Mybatis/" title="Mybaits">Mybaits</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/desinMode/" title="分类于 desinMode">desinMode</a></div><span><a href="/designMode/%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/" title="适配器模式">适配器模式</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">xiaou @ xiaou</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">488k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">7:23</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"springboot/Import 注解/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,copy_tex:!0,katex:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//fastly.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->