<!-- build time:Mon Oct 17 2022 10:22:21 GMT+0000 (Coordinated Universal Time) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="xiaou博客" href="https://blog.xiaou.icu/rss.xml"><link rel="alternate" type="application/atom+xml" title="xiaou博客" href="https://blog.xiaou.icu/atom.xml"><link rel="alternate" type="application/json" title="xiaou博客" href="https://blog.xiaou.icu/feed.json"><link rel="stylesheet" href="//fonts.lug.ustc.edu.cn/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="java"><link rel="canonical" href="https://blog.xiaou.icu/JVM/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B8%B8%E9%87%8F%E6%B1%A0/"><title>字符串常量池 - JVM | xiaou = xiaou博客</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">字符串常量池</h1><div class="meta"><span class="item" title="创建时间：2022-02-02 21:28:11"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-02-02T21:28:11+08:00">2022-02-02</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>17k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>15 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">xiaou</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://s6.jpg.cm/2022/03/14/L2EW9k.jpg"></li><li class="item" data-background-image="https://s6.jpg.cm/2022/03/14/L2s4Vu.jpg"></li><li class="item" data-background-image="https://s6.jpg.cm/2022/03/14/L2sI6G.jpg"></li><li class="item" data-background-image="https://s6.jpg.cm/2022/03/14/L2sVFW.jpg"></li><li class="item" data-background-image="https://s6.jpg.cm/2022/03/14/L2sN6i.jpg"></li><li class="item" data-background-image="https://s6.jpg.cm/2022/03/14/L2rgzU.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/JVM/" itemprop="item" rel="index" title="分类于 JVM"><span itemprop="name">JVM</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://blog.xiaou.icu/JVM/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B8%B8%E9%87%8F%E6%B1%A0/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="xiaou"><meta itemprop="description" content=", xiaou博客"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="xiaou博客"></span><div class="body md" itemprop="articleBody"><h1 id="字符串常量池"><a class="anchor" href="#字符串常量池">#</a> 字符串常量池</h1><h2 id="string的基本特性"><a class="anchor" href="#string的基本特性">#</a> String 的基本特性</h2><ol><li><p>String：字符串，使用一对 &quot;&quot; 引起来表示</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">"atguigu"</span> <span class="token punctuation">;</span>               <span class="token comment">// 字面量的定义方式</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token class-name">String</span> s2 <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">//new 对象的方式 Copy to clipboardErrorCopied</span></pre></td></tr></table></figure></li><li><p>String 被声明为 final 的，不可被继承</p></li><li><p>String 实现了 Serializable 接口：表示字符串是支持序列化的。实现了 Comparable 接口：表示 String 可以比较大小</p></li><li><p>String 在 jdk8 及以前内部定义了 <code>final char value[]</code> 用于存储字符串数据。JDK9 时改为 <code>byte[]</code></p></li></ol><h2 id="为什么-jdk9-改变了-string-的结构"><a class="anchor" href="#为什么-jdk9-改变了-string-的结构">#</a> 为什么 JDK9 改变了 String 的结构</h2><p><strong>为什么改为 byte [] 存储？</strong></p><ol><li>String 类的当前实现将字符存储在 char 数组中，每个字符使用两个字节 (16 位)。</li><li>从许多不同的应用程序收集的数据表明，字符串是堆使用的主要组成部分，而且大多数字符串对象只包含拉丁字符（Latin-1）。这些字符只需要一个字节的存储空间，因此这些字符串对象的内部 char 数组中有一半的空间将不会使用，产生了大量浪费。</li><li>之前 String 类使用 UTF-16 的 char [] 数组存储，现在改为 byte [] 数组 外加一个编码标识存储。该编码表示如果你的字符是 ISO-8859-1 或者 Latin-1，那么只需要一个字节存。如果你是其它字符集，比如 UTF-8，你仍然用两个字节存</li><li>结论：String 再也不用 char [] 来存储了，改成了 byte [] 加上编码标记，节约了一些空间</li><li>同时基于 String 的数据结构，例如 StringBuffer 和 StringBuilder 也同样做了修改</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 之前</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">char</span> value<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// 之后</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> value</pre></td></tr></table></figure><h2 id="string-的基本特性"><a class="anchor" href="#string-的基本特性">#</a> String 的基本特性</h2><ul><li>String：代表不可变的字符序列。简称：不可变性。</li></ul><ol><li>当对字符串重新赋值时，需要重写指定内存区域赋值，不能使用原有的 value 进行赋值。</li><li>当对现有的字符串进行连接操作时，也需要重新指定内存区域赋值，不能使用原有的 value 进行赋值。</li><li>当调用 String 的 replace () 方法修改指定字符或字符串时，也需要重新指定内存区域赋值，不能使用原有的 value 进行赋值。</li></ol><ul><li>通过字面量的方式（区别于 new）给一个字符串赋值，此时的字符串值声明在字符串常量池中。</li></ul><p><strong>当对字符串重新赋值时，需要重写指定内存区域赋值，不能使用原有的 value 进行赋值</strong></p><p><strong>代码</strong></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">"abc"</span><span class="token punctuation">;</span><span class="token comment">// 字面量定义的方式，"abc" 存储在字符串常量池中</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">"abc"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    s1 <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 判断地址：false</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// abc</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>字节码指令</p><ul><li>取字符串 “abc” 时，使用的是同一个符号引用：#2</li><li>取字符串 “hello” 时，使用的是另一个符号引用：#3</li></ul><p><strong>当对现有的字符串进行连接操作时，也需要重新指定内存区域赋值，不能使用原有的 value 进行赋值</strong></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">"abc"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">"abc"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    s2 <span class="token operator">+=</span> <span class="token string">"def"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// abcdef</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// abc</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>当调用 string 的 replace () 方法修改指定字符或字符串时，也需要重新指定内存区域赋值，不能使用原有的 value 进行赋值</strong></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">"abc"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">String</span> s2 <span class="token operator">=</span> s1<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token char">'a'</span><span class="token punctuation">,</span> <span class="token char">'m'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//abc</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//mbc</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>一道笔试题</strong></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringExer</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"good"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ch <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'t'</span><span class="token punctuation">,</span> <span class="token char">'e'</span><span class="token punctuation">,</span> <span class="token char">'s'</span><span class="token punctuation">,</span> <span class="token char">'t'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">change</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">,</span> <span class="token keyword">char</span> ch<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        str <span class="token operator">=</span> <span class="token string">"test ok"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        ch<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'b'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token class-name">StringExer</span> ex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringExer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        ex<span class="token punctuation">.</span><span class="token function">change</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span>str<span class="token punctuation">,</span> ex<span class="token punctuation">.</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// good</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// best</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>str 的内容并没有变：“test ok” 位于字符串常量池中的另一个区域（地址），进行赋值操作并没有修改原来 str 指向的引用的内容。</p><h2 id="string-的底层结构"><a class="anchor" href="#string-的底层结构">#</a> String 的底层结构</h2><p><strong>字符串常量池是不会存储相同内容的字符串的</strong></p><ol><li>String 的 String Pool（字符串常量池）是一个固定大小的 Hashtable，默认值大小长度是 1009。如果放进 String Pool 的 String 非常多，就会造成 Hash 冲突严重，从而导致链表会很长，而链表长了后直接会造成的影响就是当调用 String.intern () 方法时性能会大幅下降。</li><li>使用 <code>-XX:StringTablesize</code> 可设置 StringTable 的长度</li><li>在 JDK6 中 StringTable 是固定的，就是 <strong>1009</strong> 的长度，所以如果常量池中的字符串过多就会导致效率下降很快，StringTablesize 设置没有要求</li><li>在 JDK7 中，StringTable 的长度默认值是 <strong>60013</strong>，StringTablesize 设置没有要求</li><li>在 JDK8 中，StringTable 的长度默认值是 <strong>60013</strong>，StringTable 可以设置的<strong>最小值为 1009</strong></li></ol><h2 id="string-的内存分配"><a class="anchor" href="#string-的内存分配">#</a> String 的内存分配</h2><ol><li>在 Java 语言中有 8 种基本数据类型和一种比较特殊的类型 String。这些类型为了使它们在运行过程中速度更快、更节省内存，都提供了一种常量池的概念。</li><li>常量池就类似一个 Java 系统级别提供的缓存。8 种基本数据类型的常量池都是系统协调的，String 类型的常量池比较特殊。它的主要使用方法有两种。<ul><li>直接使用双引号声明出来的 String 对象会直接存储在常量池中。比如： <code>String info=&quot;atguigu.com&quot;;</code></li><li>如果不是用双引号声明的 String 对象，可以使用 String 提供的 intern () 方法。这个后面重点谈</li></ul></li></ol><p><strong>各个版本字符串的存放位置</strong></p><ol><li><p>Java 6 及以前，字符串常量池存放在永久代</p></li><li><p>Java 7 中 Oracle 的工程师对字符串池的逻辑做了很大的改变，即将字符串常量池的位置调整到 Java 堆内</p><ul><li><p>所有的字符串都保存在堆（Heap）中，和其他普通对象一样，这样可以让你在进行调优应用时仅需要调整堆大小就可以了。</p></li><li><p>字符串常量池概念原本使用得比较多，但是这个改动使得我们有足够的理由让我们重新考虑在 Java 7 中使用 String.intern ()。</p></li></ul></li><li><p>Java8 元空间，字符串常量在堆</p></li></ol><h3 id="stringtable-为什么要调整"><a class="anchor" href="#stringtable-为什么要调整">#</a> StringTable 为什么要调整？</h3><ol><li>为什么要调整位置？<ul><li>永久代的默认空间大小比较小</li><li>永久代垃圾回收频率低，大量的字符串无法及时回收，容易进行 Full GC 产生 STW 或者容易产生 OOM：PermGen Space</li><li>堆中空间足够大，字符串可被及时回收</li></ul></li><li>在 JDK 7 中，interned 字符串不再在 Java 堆的永久代中分配，而是在 Java 堆的主要部分（称为年轻代和年老代）中分配，与应用程序创建的其他对象一起分配。</li><li>此更改将导致驻留在主 Java 堆中的数据更多，驻留在永久生成中的数据更少，因此可能需要调整堆大小。</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre> * jdk6 中：</pre></td></tr><tr><td data-num="3"></td><td><pre> * -XX:PermSize=6m -XX:MaxPermSize=6m -Xms6m -Xmx6m</pre></td></tr><tr><td data-num="4"></td><td><pre> *</pre></td></tr><tr><td data-num="5"></td><td><pre> * jdk8 中：</pre></td></tr><tr><td data-num="6"></td><td><pre> * -XX:MetaspaceSize=6m -XX:MaxMetaspaceSize=6m -Xms6m -Xmx6m</pre></td></tr><tr><td data-num="7"></td><td><pre> */</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringTest3</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token comment">// 使用 Set 保持着常量池引用，避免 full gc 回收常量池行为</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token comment">// 在 short 可以取值的范围内足以让 6MB 的 PermSize 或 heap 产生 OOM 了。</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">short</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>输出结果：我真没骗你，字符串真的在堆中（JDK8）</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">Exception</span> in thread <span class="token string">"main"</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>OutOfMemoryError</span><span class="token operator">:</span> <span class="token class-name">Java</span> heap space</pre></td></tr><tr><td data-num="2"></td><td><pre>    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>HashMap</span><span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token class-name">HashMap</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">703</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>HashMap</span><span class="token punctuation">.</span><span class="token function">putVal</span><span class="token punctuation">(</span><span class="token class-name">HashMap</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">662</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>HashMap</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">HashMap</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">611</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>HashSet</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">HashSet</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">219</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>java<span class="token punctuation">.</span></span>StringTest3</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">StringTest3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">22</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">1</span></pre></td></tr></table></figure><h2 id="string-的基本操作"><a class="anchor" href="#string-的基本操作">#</a> String 的基本操作</h2><div class="note info"><p>Java 语言规范里要求完全相同的字符串字面量，应该包含同样的 Unicode 字符序列（包含同一份码点序列的常量），并且必须是指向同一个 String 类实例。</p></div><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringTest4</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// String 数量 2110</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// String 数量 2111</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"6"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"7"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"9"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"10"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// String 数量 2121</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token comment">// 如下的字符串 "1" 到 "10" 不会再次加载</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// String 数量 2121</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// String 数量 2121</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"6"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"7"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"9"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"10"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// String 数量 2121</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 官方示例代码</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Memory</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//line 1</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//line 2</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//line 3</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token class-name">Memory</span> mem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Memory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//line 4</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        mem<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//line 5</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token comment">//line 9</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token class-name">Object</span> param<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//line 6</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token class-name">String</span> str <span class="token operator">=</span> param<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//line 7</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token comment">//line 8</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img data-src="https://fastly.jsdelivr.net/gh/xiaou66/picture@master/image/1646538210137image-20220203144258702.png" alt="image-20220203144258702"></p><h2 id="字符串拼接操作"><a class="anchor" href="#字符串拼接操作">#</a> 字符串拼接操作</h2><ol><li>常量与常量的拼接结果在常量池，原理是编译期优化</li><li>常量池中不会存在相同内容的变量</li><li>拼接前后，只要其中有一个是变量，结果就在堆中。变量拼接的原理是 StringBuilder</li><li>如果拼接的结果调用 <code>intern()</code> 方法，根据该字符串是否在常量池中存在，分为：<ul><li>如果存在，则返回字符串在常量池中的地址</li><li>如果字符串常量池中不存在该字符串，则在常量池中创建一份，并返回此对象的地址</li></ul></li></ol><p><strong>常量与常量的拼接结果在常量池，原理是编译期优化</strong></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">"a"</span> <span class="token operator">+</span> <span class="token string">"b"</span> <span class="token operator">+</span> <span class="token string">"c"</span><span class="token punctuation">;</span><span class="token comment">// 编译期优化：等同于 "abc"</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">"abc"</span><span class="token punctuation">;</span> <span class="token comment">// "abc" 一定是放在字符串常量池中，将此地址赋给 s2</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">/*</span></pre></td></tr><tr><td data-num="6"></td><td><pre>     * 最终.java 编译成.class, 再执行.class</pre></td></tr><tr><td data-num="7"></td><td><pre>     * String s1 = "abc";</pre></td></tr><tr><td data-num="8"></td><td><pre>     * String s2 = "abc"</pre></td></tr><tr><td data-num="9"></td><td><pre>     */</pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>字节码</strong></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">0</span> ldc #<span class="token number">2</span> <span class="token generics"><span class="token punctuation">&lt;</span>abc<span class="token punctuation">></span></span> <span class="token comment">// "a" + "b" + "c"</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token number">2</span> astore_1</pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token number">3</span> ldc #<span class="token number">2</span> <span class="token generics"><span class="token punctuation">&lt;</span>abc<span class="token punctuation">></span></span> <span class="token comment">// 发现引用和上面字符串引用一致</span></pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token number">5</span> astore_2</pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token number">6</span> getstatic #<span class="token number">4</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">System</span><span class="token punctuation">.</span>out <span class="token operator">:</span> <span class="token class-name">Ljava</span><span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token number">9</span> aload_1</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">10</span> aload_2</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">11</span> if_acmpne <span class="token number">18</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">7</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">14</span> iconst_1</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">15</span> <span class="token keyword">goto</span> <span class="token number">19</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">18</span> iconst_0</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token number">19</span> invokevirtual #<span class="token number">5</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">.</span>println <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Z</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">></span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token number">22</span> getstatic #<span class="token number">4</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">System</span><span class="token punctuation">.</span>out <span class="token operator">:</span> <span class="token class-name">Ljava</span><span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token number">25</span> aload_1</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">26</span> aload_2</pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token number">27</span> invokevirtual #<span class="token number">7</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">.</span>equals <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Object</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">Z</span><span class="token operator">></span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token number">30</span> invokevirtual #<span class="token number">5</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">.</span>println <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Z</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">></span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token number">33</span> <span class="token keyword">return</span></pre></td></tr></table></figure><p><strong>拼接前后，只要其中有一个是变量，结果就在堆中</strong></p><p><strong>调用 intern () 方法，则主动将字符串对象存入字符串常量池中，并将其地址返回</strong></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">"javaEE"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">"hadoop"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token class-name">String</span> s3 <span class="token operator">=</span> <span class="token string">"javaEEhadoop"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token class-name">String</span> s4 <span class="token operator">=</span> <span class="token string">"javaEE"</span> <span class="token operator">+</span> <span class="token string">"hadoop"</span><span class="token punctuation">;</span><span class="token comment">// 编译期优化</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// 如果拼接符号的前后出现了变量，则相当于在堆空间中 new String ()</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">// 具体的内容为拼接的结果：javaEEhadoop</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token class-name">String</span> s5 <span class="token operator">=</span> s1 <span class="token operator">+</span> <span class="token string">"hadoop"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token class-name">String</span> s6 <span class="token operator">=</span> <span class="token string">"javaEE"</span> <span class="token operator">+</span> s2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token class-name">String</span> s7 <span class="token operator">=</span> s1 <span class="token operator">+</span> s2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// true</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s5<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// false</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s6<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// false</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s7<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// false</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s5 <span class="token operator">==</span> s6<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// false</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s5 <span class="token operator">==</span> s7<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// false</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s6 <span class="token operator">==</span> s7<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// false</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token comment">//intern (): 判断字符串常量池中是否存在 javaEEhadoop 值</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token comment">// 如果存在，则返回常量池中 javaEEhadoop 的地址</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token comment">// 如果字符串常量池中不存在 javaEEhadoop</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token comment">// 则在常量池中加载一份 javaEEhadoop，并返回次对象的地址。</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token class-name">String</span> s8 <span class="token operator">=</span> s6<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s8<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// true</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>从字节码角度来看：拼接前后有变量，都会使用到 StringBuilder 类</strong></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">0</span> ldc #<span class="token number">8</span> <span class="token generics"><span class="token punctuation">&lt;</span>javaEE<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token number">2</span> astore_1</pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token number">3</span> ldc #<span class="token number">9</span> <span class="token generics"><span class="token punctuation">&lt;</span>hadoop<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token number">5</span> astore_2</pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token number">6</span> ldc #<span class="token number">10</span> <span class="token generics"><span class="token punctuation">&lt;</span>javaEEhadoop<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token number">8</span> astore_3</pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token number">9</span> ldc #<span class="token number">10</span> <span class="token generics"><span class="token punctuation">&lt;</span>javaEEhadoop<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token number">11</span> astore <span class="token number">4</span></pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token number">13</span> <span class="token keyword">new</span> #<span class="token number">11</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token operator">></span></pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token number">16</span> dup</pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token number">17</span> invokespecial #<span class="token number">12</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">></span></span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">></span></pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token number">20</span> aload_1</pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token number">21</span> invokevirtual #<span class="token number">13</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">.</span>append <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token number">24</span> ldc #<span class="token number">9</span> <span class="token generics"><span class="token punctuation">&lt;</span>hadoop<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="15"></td><td><pre> <span class="token number">26</span> invokevirtual #<span class="token number">13</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">.</span>append <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="16"></td><td><pre> <span class="token number">29</span> invokevirtual #<span class="token number">14</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">.</span>toString <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="17"></td><td><pre> <span class="token number">32</span> astore <span class="token number">5</span></pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token number">34</span> <span class="token keyword">new</span> #<span class="token number">11</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token operator">></span></pre></td></tr><tr><td data-num="19"></td><td><pre> <span class="token number">37</span> dup</pre></td></tr><tr><td data-num="20"></td><td><pre> <span class="token number">38</span> invokespecial #<span class="token number">12</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">></span></span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">></span></pre></td></tr><tr><td data-num="21"></td><td><pre> <span class="token number">41</span> ldc #<span class="token number">8</span> <span class="token generics"><span class="token punctuation">&lt;</span>javaEE<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="22"></td><td><pre> <span class="token number">43</span> invokevirtual #<span class="token number">13</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">.</span>append <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="23"></td><td><pre> <span class="token number">46</span> aload_2</pre></td></tr><tr><td data-num="24"></td><td><pre> <span class="token number">47</span> invokevirtual #<span class="token number">13</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">.</span>append <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="25"></td><td><pre> <span class="token number">50</span> invokevirtual #<span class="token number">14</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">.</span>toString <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="26"></td><td><pre> <span class="token number">53</span> astore <span class="token number">6</span></pre></td></tr><tr><td data-num="27"></td><td><pre> <span class="token number">55</span> <span class="token keyword">new</span> #<span class="token number">11</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token operator">></span></pre></td></tr><tr><td data-num="28"></td><td><pre> <span class="token number">58</span> dup</pre></td></tr><tr><td data-num="29"></td><td><pre> <span class="token number">59</span> invokespecial #<span class="token number">12</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">></span></span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">></span></pre></td></tr><tr><td data-num="30"></td><td><pre> <span class="token number">62</span> aload_1</pre></td></tr><tr><td data-num="31"></td><td><pre> <span class="token number">63</span> invokevirtual #<span class="token number">13</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">.</span>append <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="32"></td><td><pre> <span class="token number">66</span> aload_2</pre></td></tr><tr><td data-num="33"></td><td><pre> <span class="token number">67</span> invokevirtual #<span class="token number">13</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">.</span>append <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="34"></td><td><pre> <span class="token number">70</span> invokevirtual #<span class="token number">14</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">.</span>toString <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="35"></td><td><pre> <span class="token number">73</span> astore <span class="token number">7</span></pre></td></tr><tr><td data-num="36"></td><td><pre> <span class="token number">75</span> getstatic #<span class="token number">4</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">System</span><span class="token punctuation">.</span>out <span class="token operator">:</span> <span class="token class-name">Ljava</span><span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="37"></td><td><pre> <span class="token number">78</span> aload_3</pre></td></tr><tr><td data-num="38"></td><td><pre> <span class="token number">79</span> aload <span class="token number">4</span></pre></td></tr><tr><td data-num="39"></td><td><pre> <span class="token number">81</span> if_acmpne <span class="token number">88</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">7</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="40"></td><td><pre> <span class="token number">84</span> iconst_1</pre></td></tr><tr><td data-num="41"></td><td><pre> <span class="token number">85</span> <span class="token keyword">goto</span> <span class="token number">89</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre> <span class="token number">88</span> iconst_0</pre></td></tr><tr><td data-num="43"></td><td><pre> <span class="token number">89</span> invokevirtual #<span class="token number">5</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">.</span>println <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Z</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">></span></pre></td></tr><tr><td data-num="44"></td><td><pre> <span class="token number">92</span> getstatic #<span class="token number">4</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">System</span><span class="token punctuation">.</span>out <span class="token operator">:</span> <span class="token class-name">Ljava</span><span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="45"></td><td><pre> <span class="token number">95</span> aload_3</pre></td></tr><tr><td data-num="46"></td><td><pre> <span class="token number">96</span> aload <span class="token number">5</span></pre></td></tr><tr><td data-num="47"></td><td><pre> <span class="token number">98</span> if_acmpne <span class="token number">105</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">7</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token number">101</span> iconst_1</pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token number">102</span> <span class="token keyword">goto</span> <span class="token number">106</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token number">105</span> iconst_0</pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token number">106</span> invokevirtual #<span class="token number">5</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">.</span>println <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Z</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">></span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token number">109</span> getstatic #<span class="token number">4</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">System</span><span class="token punctuation">.</span>out <span class="token operator">:</span> <span class="token class-name">Ljava</span><span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token number">112</span> aload_3</pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token number">113</span> aload <span class="token number">6</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token number">115</span> if_acmpne <span class="token number">122</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">7</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token number">118</span> iconst_1</pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token number">119</span> <span class="token keyword">goto</span> <span class="token number">123</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token number">122</span> iconst_0</pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token number">123</span> invokevirtual #<span class="token number">5</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">.</span>println <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Z</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">></span></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token number">126</span> getstatic #<span class="token number">4</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">System</span><span class="token punctuation">.</span>out <span class="token operator">:</span> <span class="token class-name">Ljava</span><span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token number">129</span> aload_3</pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token number">130</span> aload <span class="token number">7</span></pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token number">132</span> if_acmpne <span class="token number">139</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">7</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token number">135</span> iconst_1</pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token number">136</span> <span class="token keyword">goto</span> <span class="token number">140</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token number">139</span> iconst_0</pre></td></tr><tr><td data-num="67"></td><td><pre><span class="token number">140</span> invokevirtual #<span class="token number">5</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">.</span>println <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Z</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">></span></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token number">143</span> getstatic #<span class="token number">4</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">System</span><span class="token punctuation">.</span>out <span class="token operator">:</span> <span class="token class-name">Ljava</span><span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="69"></td><td><pre><span class="token number">146</span> aload <span class="token number">5</span></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token number">148</span> aload <span class="token number">6</span></pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token number">150</span> if_acmpne <span class="token number">157</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">7</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token number">153</span> iconst_1</pre></td></tr><tr><td data-num="73"></td><td><pre><span class="token number">154</span> <span class="token keyword">goto</span> <span class="token number">158</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="74"></td><td><pre><span class="token number">157</span> iconst_0</pre></td></tr><tr><td data-num="75"></td><td><pre><span class="token number">158</span> invokevirtual #<span class="token number">5</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">.</span>println <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Z</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">></span></pre></td></tr><tr><td data-num="76"></td><td><pre><span class="token number">161</span> getstatic #<span class="token number">4</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">System</span><span class="token punctuation">.</span>out <span class="token operator">:</span> <span class="token class-name">Ljava</span><span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="77"></td><td><pre><span class="token number">164</span> aload <span class="token number">5</span></pre></td></tr><tr><td data-num="78"></td><td><pre><span class="token number">166</span> aload <span class="token number">7</span></pre></td></tr><tr><td data-num="79"></td><td><pre><span class="token number">168</span> if_acmpne <span class="token number">175</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">7</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="80"></td><td><pre><span class="token number">171</span> iconst_1</pre></td></tr><tr><td data-num="81"></td><td><pre><span class="token number">172</span> <span class="token keyword">goto</span> <span class="token number">176</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="82"></td><td><pre><span class="token number">175</span> iconst_0</pre></td></tr><tr><td data-num="83"></td><td><pre><span class="token number">176</span> invokevirtual #<span class="token number">5</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">.</span>println <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Z</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">></span></pre></td></tr><tr><td data-num="84"></td><td><pre><span class="token number">179</span> getstatic #<span class="token number">4</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">System</span><span class="token punctuation">.</span>out <span class="token operator">:</span> <span class="token class-name">Ljava</span><span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="85"></td><td><pre><span class="token number">182</span> aload <span class="token number">6</span></pre></td></tr><tr><td data-num="86"></td><td><pre><span class="token number">184</span> aload <span class="token number">7</span></pre></td></tr><tr><td data-num="87"></td><td><pre><span class="token number">186</span> if_acmpne <span class="token number">193</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">7</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="88"></td><td><pre><span class="token number">189</span> iconst_1</pre></td></tr><tr><td data-num="89"></td><td><pre><span class="token number">190</span> <span class="token keyword">goto</span> <span class="token number">194</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="90"></td><td><pre><span class="token number">193</span> iconst_0</pre></td></tr><tr><td data-num="91"></td><td><pre><span class="token number">194</span> invokevirtual #<span class="token number">5</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">.</span>println <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Z</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">></span></pre></td></tr><tr><td data-num="92"></td><td><pre><span class="token number">197</span> aload <span class="token number">6</span></pre></td></tr><tr><td data-num="93"></td><td><pre><span class="token number">199</span> invokevirtual #<span class="token number">15</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">.</span>intern <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="94"></td><td><pre><span class="token number">202</span> astore <span class="token number">8</span></pre></td></tr><tr><td data-num="95"></td><td><pre><span class="token number">204</span> getstatic #<span class="token number">4</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">System</span><span class="token punctuation">.</span>out <span class="token operator">:</span> <span class="token class-name">Ljava</span><span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="96"></td><td><pre><span class="token number">207</span> aload_3</pre></td></tr><tr><td data-num="97"></td><td><pre><span class="token number">208</span> aload <span class="token number">8</span></pre></td></tr><tr><td data-num="98"></td><td><pre><span class="token number">210</span> if_acmpne <span class="token number">217</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">7</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="99"></td><td><pre><span class="token number">213</span> iconst_1</pre></td></tr><tr><td data-num="100"></td><td><pre><span class="token number">214</span> <span class="token keyword">goto</span> <span class="token number">218</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="101"></td><td><pre><span class="token number">217</span> iconst_0</pre></td></tr><tr><td data-num="102"></td><td><pre><span class="token number">218</span> invokevirtual #<span class="token number">5</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">.</span>println <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Z</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">></span></pre></td></tr><tr><td data-num="103"></td><td><pre><span class="token number">221</span> <span class="token keyword">return</span></pre></td></tr></table></figure><h3 id="字符串拼接的底层细节"><a class="anchor" href="#字符串拼接的底层细节">#</a> 字符串拼接的底层细节</h3><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">"a"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">"b"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token class-name">String</span> s3 <span class="token operator">=</span> <span class="token string">"ab"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">/*</span></pre></td></tr><tr><td data-num="7"></td><td><pre>       如下的 s1 + s2 的执行细节：(变量 s 是我临时定义的）</pre></td></tr><tr><td data-num="8"></td><td><pre>       ① StringBuilder s = new StringBuilder ();</pre></td></tr><tr><td data-num="9"></td><td><pre>       ② s.append ("a")</pre></td></tr><tr><td data-num="10"></td><td><pre>       ③ s.append ("b")</pre></td></tr><tr><td data-num="11"></td><td><pre>       ④ s.toString ()  --> 约等于 new String ("ab")，但不等价</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>       补充：在 jdk5.0 之后使用的是 StringBuilder, 在 jdk5.0 之前使用的是 StringBuffer</pre></td></tr><tr><td data-num="14"></td><td><pre>      */</pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token class-name">String</span> s4 <span class="token operator">=</span> s1 <span class="token operator">+</span> s2<span class="token punctuation">;</span><span class="token comment">//</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>字节码指令</strong></p><pre><code class="language-JAVA">0 ldc #14 &lt;a&gt;
2 astore_1
3 ldc #15 &lt;b&gt;
5 astore_2
6 ldc #16 &lt;ab&gt;
8 astore_3
9 new #9 &lt;java/lang/StringBuilder&gt;
12 dup
13 invokespecial #10 &lt;java/lang/StringBuilder.&lt;init&gt;&gt;
16 aload_1
17 invokevirtual #11 &lt;java/lang/StringBuilder.append&gt;
20 aload_2
21 invokevirtual #11 &lt;java/lang/StringBuilder.append&gt;
24 invokevirtual #12 &lt;java/lang/StringBuilder.toString&gt;
27 astore 4
29 getstatic #3 &lt;java/lang/System.out&gt;
32 aload_3
33 aload 4
35 if_acmpne 42 (+7)
38 iconst_1
39 goto 43 (+4)
42 iconst_0
43 invokevirtual #4 &lt;java/io/PrintStream.println&gt;
46 return
</code></pre><h3 id="字符串拼接操作不一定使用的是-stringbuilder"><a class="anchor" href="#字符串拼接操作不一定使用的是-stringbuilder">#</a> 字符串拼接操作不一定使用的是 StringBuilder!</h3><pre><code class="language-JAVA">/*
 1. 字符串拼接操作不一定使用的是 StringBuilder!
       如果拼接符号左右两边都是字符串常量或常量引用，则仍然使用编译期优化，即非 StringBuilder 的方式。
 2. 针对于 final 修饰类、方法、基本数据类型、引用数据类型的量的结构时，能使用上 final 的时候建议使用上。
*/
@Test
public void test5()&#123;
    final String s1 = &quot;a&quot;;
    final String s2 = &quot;b&quot;;
    String s3 = &quot;ab&quot;;
    String s4 = s1 + s2;
    System.out.println(s3 == s4);//true
&#125;
</code></pre><p><strong>字节码</strong></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">0</span> ldc #<span class="token number">14</span> <span class="token generics"><span class="token punctuation">&lt;</span>a<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">2</span> astore_1</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">3</span> ldc #<span class="token number">15</span> <span class="token generics"><span class="token punctuation">&lt;</span>b<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">5</span> astore_2</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">6</span> ldc #<span class="token number">16</span> <span class="token generics"><span class="token punctuation">&lt;</span>ab<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">8</span> astore_3</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">9</span> ldc #<span class="token number">16</span> <span class="token generics"><span class="token punctuation">&lt;</span>ab<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">11</span> astore <span class="token number">4</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">13</span> getstatic #<span class="token number">3</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">16</span> aload_3</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">17</span> aload <span class="token number">4</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token number">19</span> if_acmpne <span class="token number">26</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">7</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token number">22</span> iconst_1</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token number">23</span> <span class="token keyword">goto</span> <span class="token number">27</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">26</span> iconst_0</pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token number">27</span> invokevirtual #<span class="token number">4</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">.</span>println<span class="token operator">></span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token number">30</span> <span class="token keyword">return</span></pre></td></tr></table></figure><p><strong>拼接操作与 append 操作的效率对比</strong></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test7</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">// method1(100000);//4014</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token function">method2</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//7</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"花费的时间为："</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token keyword">int</span> highLevel<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token class-name">String</span> src <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> highLevel<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        src <span class="token operator">=</span> src <span class="token operator">+</span> <span class="token string">"a"</span><span class="token punctuation">;</span><span class="token comment">// 每次循环都会创建一个 StringBuilder、String</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment">// System.out.println(src);</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token keyword">int</span> highLevel<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token comment">// 只需要创建一个 StringBuilder</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token class-name">StringBuilder</span> src <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> highLevel<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        src<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token comment">// System.out.println(src);</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol><li>体会执行效率：通过 StringBuilder 的 append () 的方式添加字符串的效率要远高于使用 String 的字符串拼接方式！</li><li>原因：<ol><li>StringBuilder 的 append () 的方式：<ul><li>自始至终中只创建过一个 StringBuilder 的对象</li></ul></li><li>使用 String 的字符串拼接方式：<ul><li>创建过多个 StringBuilder 和 String（调的 toString 方法）的对象，内存占用更大；</li><li>如果进行 GC，需要花费额外的时间（在拼接的过程中产生的一些中间字符串可能永远也用不到，会产生大量垃圾字符串）。</li></ul></li></ol></li><li>改进的空间：<ul><li>在实际开发中，如果基本确定要前前后后添加的字符串长度不高于某个限定值 highLevel 的情况下，建议使用构造器实例化：</li><li><code>StringBuilder s = new StringBuilder(highLevel); //new char[highLevel]</code></li><li>这样可以避免频繁扩容</li></ul></li></ol><h2 id="intern-的使用"><a class="anchor" href="#intern-的使用">#</a> intern () 的使用</h2><h3 id="方法签名"><a class="anchor" href="#方法签名">#</a> 方法签名</h3><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token class-name">String</span> <span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="说明"><a class="anchor" href="#说明">#</a> 说明</h3><ol><li><p>intern 是一个 native 方法，调用的是底层 C 的方法</p></li><li><p>字符串常量池池最初是空的，由 String 类私有地维护。在调用 intern 方法时，如果池中已经包含了由 equals (object) 方法确定的与该字符串内容相等的字符串，则返回池中的字符串地址。否则，该字符串对象将被添加到池中，并返回对该字符串对象的地址。（这是源码里的大概翻译）</p></li><li><p>如果不是用双引号声明的 String 对象，可以使用 String 提供的 intern 方法：intern 方法会从字符串常量池中查询当前字符串是否存在，若不存在就会将当前字符串放入常量池中。比如：</p><p><code>String myInfo = new string(&quot;I love atguigu&quot;).intern();Copy to clipboardErrorCopied</code></p></li><li><p>也就是说，如果在任意字符串上调用 String.intern 方法，那么其返回结果所指向的那个类实例，必须和直接以常量形式出现的字符串实例完全相同。因此，下列表达式的值必定是 true</p><p><code>(&quot;a&quot;+&quot;b&quot;+&quot;c&quot;).intern()==&quot;abc&quot;Copy to clipboardErrorCopied</code></p></li><li><p>通俗点讲，Interned String 就是确保字符串在内存里只有一份拷贝，这样可以节约内存空间，加快字符串操作任务的执行速度。注意，这个值会被存放在字符串内部池（String Intern Pool）</p></li></ol><h3 id="new-string-的说明"><a class="anchor" href="#new-string-的说明">#</a> new String () 的说明</h3><h4 id="new-stringab会创建几个对象"><a class="anchor" href="#new-stringab会创建几个对象">#</a> new String (“ab”) 会创建几个对象？</h4><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre> * 题目：</pre></td></tr><tr><td data-num="3"></td><td><pre> * new String ("ab") 会创建几个对象？看字节码，就知道是两个。</pre></td></tr><tr><td data-num="4"></td><td><pre> *     一个对象是：new 关键字在堆空间创建的</pre></td></tr><tr><td data-num="5"></td><td><pre> *     另一个对象是：字符串常量池中的对象 "ab"。 字节码指令：ldc</pre></td></tr><tr><td data-num="6"></td><td><pre> *</pre></td></tr><tr><td data-num="7"></td><td><pre> */</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringNewTest</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"ab"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>字节码</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">0</span> <span class="token keyword">new</span> #<span class="token number">2</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token operator">></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">3</span> dup</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">4</span> ldc #<span class="token number">3</span> <span class="token generics"><span class="token punctuation">&lt;</span>ab<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">6</span> invokespecial #<span class="token number">4</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">></span></span><span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">9</span> astore_1</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">10</span> <span class="token keyword">return</span></pre></td></tr></table></figure><h4 id="new-stringa-new-stringb-会创建几个对象"><a class="anchor" href="#new-stringa-new-stringb-会创建几个对象">#</a> new String (“a”) + new String (“b”) 会创建几个对象？</h4><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre> * 思考：</pre></td></tr><tr><td data-num="3"></td><td><pre> *   new String ("a") + new String ("b") 呢？</pre></td></tr><tr><td data-num="4"></td><td><pre> *  对象 1： new StringBuilder ()</pre></td></tr><tr><td data-num="5"></td><td><pre> *  对象 2： new String ("a")</pre></td></tr><tr><td data-num="6"></td><td><pre> *  对象 3： 常量池中的 "a"</pre></td></tr><tr><td data-num="7"></td><td><pre> *  对象 4： new String ("b")</pre></td></tr><tr><td data-num="8"></td><td><pre> *  对象 5： 常量池中的 "b"</pre></td></tr><tr><td data-num="9"></td><td><pre> *</pre></td></tr><tr><td data-num="10"></td><td><pre> *  深入剖析： StringBuilder 的 toString ():</pre></td></tr><tr><td data-num="11"></td><td><pre> *      对象 6 ：new String ("ab")</pre></td></tr><tr><td data-num="12"></td><td><pre> *       强调一下，toString () 的调用，在字符串常量池中，没有生成 "ab"</pre></td></tr><tr><td data-num="13"></td><td><pre> *</pre></td></tr><tr><td data-num="14"></td><td><pre> */</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringNewTest</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>字节码</strong></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 拼接字符串会创建一个 StringBuilder 对象 </span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token number">0</span> <span class="token keyword">new</span> #<span class="token number">2</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token operator">></span></pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token number">3</span> dup</pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token number">4</span> invokespecial #<span class="token number">3</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">></span></span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token comment">// 创建 String 对象，对应于 new String (“a”)</span></pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token number">7</span> <span class="token keyword">new</span> #<span class="token number">4</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token operator">></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">10</span> dup</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// 在字符串常量池中放入 “a”（如果之前字符串常量池中没有 “a” 的话）</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">11</span> ldc #<span class="token number">5</span> <span class="token generics"><span class="token punctuation">&lt;</span>a<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">13</span> invokespecial #<span class="token number">6</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">></span></span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">></span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">16</span> invokevirtual #<span class="token number">7</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">.</span>append <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">// 创建 String 对象，对应于 new String (“b”)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token number">19</span> <span class="token keyword">new</span> #<span class="token number">4</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token operator">></span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token number">22</span> dup</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">// 在字符串常量池中放入 “b”（如果之前字符串常量池中没有 “b” 的话）</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token number">23</span> ldc #<span class="token number">8</span> <span class="token generics"><span class="token punctuation">&lt;</span>b<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token number">25</span> invokespecial #<span class="token number">6</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">></span></span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">></span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token number">28</span> invokevirtual #<span class="token number">7</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">.</span>append <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">// 调用 StringBuilder 的 toString () 方法，会生成一个 String 对象</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token number">31</span> invokevirtual #<span class="token number">9</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">.</span>toString <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token number">34</span> astore_1</pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token number">35</span> <span class="token keyword">return</span></pre></td></tr></table></figure><h3 id="有点难的面试题"><a class="anchor" href="#有点难的面试题">#</a> 有点难的面试题</h3><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre> * 如何保证变量 s 指向的是字符串常量池中的数据呢？</pre></td></tr><tr><td data-num="3"></td><td><pre> * 有两种方式：</pre></td></tr><tr><td data-num="4"></td><td><pre> * 方式一： String s = "shkstart";// 字面量定义的方式</pre></td></tr><tr><td data-num="5"></td><td><pre> * 方式二： 调用 intern ()</pre></td></tr><tr><td data-num="6"></td><td><pre> *         String s = new String ("shkstart").intern ();</pre></td></tr><tr><td data-num="7"></td><td><pre> *         String s = new StringBuilder ("shkstart").toString ().intern ();</pre></td></tr><tr><td data-num="8"></td><td><pre> *</pre></td></tr><tr><td data-num="9"></td><td><pre> */</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span>  <span class="token class-name">StringIntern</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        s<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 调用此方法之前，字符串常量池中已经存在了 "1"</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// jdk6：false   jdk7/8：false</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token comment">/*</span></pre></td></tr><tr><td data-num="19"></td><td><pre>         1、s3 变量记录的地址为：new String ("11")</pre></td></tr><tr><td data-num="20"></td><td><pre>         2、经过上面的分析，我们已经知道执行完 pos_1 的代码，在堆中有了一个 new String ("11")</pre></td></tr><tr><td data-num="21"></td><td><pre>         这样的 String 对象。但是在字符串常量池中没有 "11"</pre></td></tr><tr><td data-num="22"></td><td><pre>         3、接着执行 s3.intern ()，在字符串常量池中生成 "11"</pre></td></tr><tr><td data-num="23"></td><td><pre>           3-1、在 JDK6 的版本中，字符串常量池还在永久代，所以直接在永久代生成 "11", 也就有了新的地址</pre></td></tr><tr><td data-num="24"></td><td><pre>           3-2、而在 JDK7 的后续版本中，字符串常量池被移动到了堆中，此时堆里已经有 new String（"11"）            了出于节省空间的目的，直接将堆中的那个字符串的引用地址储存在字符串常量池中。</pre></td></tr><tr><td data-num="25"></td><td><pre>           没错，字符串常量 池中存的是 new String（"11"）在堆中的地址</pre></td></tr><tr><td data-num="26"></td><td><pre>         4、所以在 JDK7 后续版本中，s3 和 s4 指向的完全是同一个地址。</pre></td></tr><tr><td data-num="27"></td><td><pre>         */</pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token class-name">String</span> s3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// pos_1</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        s3<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token comment">//s4 变量记录的地址：使用的是上一行代码代码执行时，在常量池中生成的 "11" 的地址</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token class-name">String</span> s4 <span class="token operator">=</span> <span class="token string">"11"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// jdk6：false  jdk7/8：true</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="拓展"><a class="anchor" href="#拓展">#</a> 拓展</h4><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre> * StringIntern.java 中练习的拓展：</pre></td></tr><tr><td data-num="3"></td><td><pre> *</pre></td></tr><tr><td data-num="4"></td><td><pre> */</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringIntern1</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token comment">// 执行完下一行代码以后，字符串常量池中，是否存在 "11" 呢？答案：不存在！！</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token comment">// 因为在 s3 生成在字节码层面上使用的是 StringBuilder 类中的 toString () 方法</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token comment">// 这个方法只在栈上存储</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token class-name">String</span> s3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// new String("11")</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token comment">// 在字符串常量池中生成对象 "11"，代码顺序换一下，实打实的在字符串常量池里有一个 "11" 对象</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token class-name">String</span> s4 <span class="token operator">=</span> <span class="token string">"11"</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token class-name">String</span> s5 <span class="token operator">=</span> s3<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token comment">//s3 是堆中的 "ab" ，s4 是字符串常量池中的 "ab"</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token comment">//s5 是从字符串常量池中取回来的引用，当然和 s4 相等</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s5 <span class="token operator">==</span> s4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="结论"><a class="anchor" href="#结论">#</a> 结论</h3><ol><li>对于程序中大量使用存在的字符串时，尤其存在很多已经重复的字符串时，使用 intern () 方法能够节省很大的内存空间。</li><li>大的网站平台，需要内存中存储大量的字符串。比如社交网站，很多人都存储：北京市、海淀区等信息。这时候如果字符串都调用 intern () 方法，就会很明显降低内存的大小。</li></ol><h2 id="stringtable-的垃圾回收"><a class="anchor" href="#stringtable-的垃圾回收">#</a> StringTable 的垃圾回收</h2><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre> * String 的垃圾回收:</pre></td></tr><tr><td data-num="3"></td><td><pre> * -Xms15m -Xmx15m -XX:+PrintStringTableStatistics -XX:+PrintGCDetails</pre></td></tr><tr><td data-num="4"></td><td><pre> */</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringGCTest</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img data-src="https://fastly.jsdelivr.net/gh/xiaou66/picture@master/image/1646538226144image-20220203162158173.png" alt="image-20220203162158173"></p><ul><li>在 PSYoungGen 区发生了垃圾回收</li><li>Number of entries 和 Number of literals 明显没有 100000</li><li>以上两点均说明 StringTable 区发生了垃圾回收</li></ul><h2 id="g1-中的-string-去重操作"><a class="anchor" href="#g1-中的-string-去重操作">#</a> G1 中的 String 去重操作</h2><blockquote><p>注意不是字符串常量池的去重操作，字符串常量池本身就没有重复的</p></blockquote><ol><li>背景：对许多 Java 应用（有大的也有小的）做的测试得出以下结果：<ul><li>堆存活数据集合里面 String 对象占了 25%</li><li>堆存活数据集合里面重复的 String 对象有 13.5%</li><li>String 对象的平均长度是 45</li></ul></li><li>许多大规模的 Java 应用的瓶颈在于内存，测试表明，在这些类型的应用里面，Java 堆中存活的数据集合差不多 25% 是 String 对象。更进一步，这里面差不多一半 String 对象是重复的，重复的意思是说： <code>str1.equals(str2)= true</code> 。堆上存在重复的 String 对象必然是一种内存的浪费。这个项目将在 G1 垃圾收集器中实现自动持续对重复的 String 对象进行去重，这样就能避免浪费内存。</li></ol><p><strong>String 去重的的实现</strong></p><ol><li>当垃圾收集器工作的时候，会访问堆上存活的对象。对每一个访问的对象都会检查是否是候选的要去重的 String 对象。</li><li>如果是，把这个对象的一个引用插入到队列中等待后续的处理。一个去重的线程在后台运行，处理这个队列。处理队列的一个元素意味着从队列删除这个元素，然后尝试去重它引用的 String 对象。</li><li>使用一个 Hashtable 来记录所有的被 String 对象使用的不重复的 char 数组。当去重的时候，会查这个 Hashtable，来看堆上是否已经存在一个一模一样的 char 数组。</li><li>如果存在，String 对象会被调整引用那个数组，释放对原来的数组的引用，最终会被垃圾收集器回收掉。</li><li>如果查找失败，char 数组会被插入到 Hashtable，这样以后的时候就可以共享这个数组了。</li></ol><p><strong>命令行选项</strong></p><ol><li>UseStringDeduplication (bool) ：开启 String 去重，默认是不开启的，需要手动开启。</li><li>PrintStringDeduplicationStatistics (bool) ：打印详细的去重统计信息</li><li>stringDeduplicationAgeThreshold (uintx) ：达到这个年龄的 String 对象被认为是去重的候选对象</li></ol><div class="tags"><a href="/tags/java/" rel="tag"><i class="ic i-tag"></i> java</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-10-17 18:21:27" itemprop="dateModified" datetime="2022-10-17T18:21:27+08:00">2022-10-17</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="xiaou 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="xiaou 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>xiaou <i class="ic i-at"><em>@</em></i>xiaou博客</li><li class="link"><strong>本文链接：</strong> <a href="https://blog.xiaou.icu/JVM/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B8%B8%E9%87%8F%E6%B1%A0/" title="字符串常量池">https://blog.xiaou.icu/JVM/字符串常量池/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/JVM/%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;s6.jpg.cm&#x2F;2022&#x2F;03&#x2F;14&#x2F;L2rVW5.jpg" title="执行引擎"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> JVM</span><h3>执行引擎</h3></a></div><div class="item right"><a href="/JVM/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%A6%82%E8%BF%B0%E5%92%8C%E7%9B%B8%E5%85%B3%E7%AE%97%E6%B3%95/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;s6.jpg.cm&#x2F;2022&#x2F;03&#x2F;14&#x2F;L2EuYX.jpg" title="垃圾回收概述和相关算法"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> JVM</span><h3>垃圾回收概述和相关算法</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B8%B8%E9%87%8F%E6%B1%A0"><span class="toc-number">1.</span> <span class="toc-text">字符串常量池</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#string%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%89%B9%E6%80%A7"><span class="toc-number">1.1.</span> <span class="toc-text">String 的基本特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-jdk9-%E6%94%B9%E5%8F%98%E4%BA%86-string-%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">1.2.</span> <span class="toc-text">为什么 JDK9 改变了 String 的结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#string-%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%89%B9%E6%80%A7"><span class="toc-number">1.3.</span> <span class="toc-text">String 的基本特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#string-%E7%9A%84%E5%BA%95%E5%B1%82%E7%BB%93%E6%9E%84"><span class="toc-number">1.4.</span> <span class="toc-text">String 的底层结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#string-%E7%9A%84%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D"><span class="toc-number">1.5.</span> <span class="toc-text">String 的内存分配</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#stringtable-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E8%B0%83%E6%95%B4"><span class="toc-number">1.5.1.</span> <span class="toc-text">StringTable 为什么要调整？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#string-%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.6.</span> <span class="toc-text">String 的基本操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5%E6%93%8D%E4%BD%9C"><span class="toc-number">1.7.</span> <span class="toc-text">字符串拼接操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5%E7%9A%84%E5%BA%95%E5%B1%82%E7%BB%86%E8%8A%82"><span class="toc-number">1.7.1.</span> <span class="toc-text">字符串拼接的底层细节</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5%E6%93%8D%E4%BD%9C%E4%B8%8D%E4%B8%80%E5%AE%9A%E4%BD%BF%E7%94%A8%E7%9A%84%E6%98%AF-stringbuilder"><span class="toc-number">1.7.2.</span> <span class="toc-text">字符串拼接操作不一定使用的是 StringBuilder!</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#intern-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.8.</span> <span class="toc-text">intern () 的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E7%AD%BE%E5%90%8D"><span class="toc-number">1.8.1.</span> <span class="toc-text">方法签名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E"><span class="toc-number">1.8.2.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#new-string-%E7%9A%84%E8%AF%B4%E6%98%8E"><span class="toc-number">1.8.3.</span> <span class="toc-text">new String () 的说明</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#new-stringab%E4%BC%9A%E5%88%9B%E5%BB%BA%E5%87%A0%E4%B8%AA%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.8.3.1.</span> <span class="toc-text">new String (“ab”) 会创建几个对象？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#new-stringa-new-stringb-%E4%BC%9A%E5%88%9B%E5%BB%BA%E5%87%A0%E4%B8%AA%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.8.3.2.</span> <span class="toc-text">new String (“a”) + new String (“b”) 会创建几个对象？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%89%E7%82%B9%E9%9A%BE%E7%9A%84%E9%9D%A2%E8%AF%95%E9%A2%98"><span class="toc-number">1.8.4.</span> <span class="toc-text">有点难的面试题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%93%E5%B1%95"><span class="toc-number">1.8.4.1.</span> <span class="toc-text">拓展</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E8%AE%BA"><span class="toc-number">1.8.5.</span> <span class="toc-text">结论</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#stringtable-%E7%9A%84%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6"><span class="toc-number">1.9.</span> <span class="toc-text">StringTable 的垃圾回收</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#g1-%E4%B8%AD%E7%9A%84-string-%E5%8E%BB%E9%87%8D%E6%93%8D%E4%BD%9C"><span class="toc-number">1.10.</span> <span class="toc-text">G1 中的 String 去重操作</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/JVM/JVM%E5%92%8CJava%E4%BD%93%E7%B3%BB%E6%9E%B6%E6%9E%84/" rel="bookmark" title="JVM和Java体系架构">JVM和Java体系架构</a></li><li><a href="/JVM/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%AD%90%E7%B3%BB%E7%BB%9F/" rel="bookmark" title="类加载器子系统">类加载器子系统</a></li><li><a href="/JVM/%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA/" rel="bookmark" title="运行时数据区">运行时数据区</a></li><li><a href="/JVM/%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88/" rel="bookmark" title="虚拟机栈">虚拟机栈</a></li><li><a href="/JVM/%E5%A0%86/" rel="bookmark" title="堆">堆</a></li><li><a href="/JVM/%E6%96%B9%E6%B3%95%E5%8C%BA/" rel="bookmark" title="方法区">方法区</a></li><li><a href="/JVM/%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E/" rel="bookmark" title="执行引擎">执行引擎</a></li><li class="active"><a href="/JVM/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B8%B8%E9%87%8F%E6%B1%A0/" rel="bookmark" title="字符串常量池">字符串常量池</a></li><li><a href="/JVM/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%A6%82%E8%BF%B0%E5%92%8C%E7%9B%B8%E5%85%B3%E7%AE%97%E6%B3%95/" rel="bookmark" title="垃圾回收概述和相关算法">垃圾回收概述和相关算法</a></li><li><a href="/JVM/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5/" rel="bookmark" title="垃圾回收相关概念">垃圾回收相关概念</a></li><li><a href="/JVM/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8/" rel="bookmark" title="垃圾回收器">垃圾回收器</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="xiaou" data-src="/images/avatar.jpg"><p class="name" itemprop="name">xiaou</p><div class="description" itemprop="description">xiaou博客</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">85</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">16</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">7</span> <span class="name">标签</span></a></div></nav><div class="social"></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/JVM/%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/JVM/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%A6%82%E8%BF%B0%E5%92%8C%E7%9B%B8%E5%85%B3%E7%AE%97%E6%B3%95/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/JVM/" title="分类于 JVM">JVM</a></div><span><a href="/JVM/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5/" title="垃圾回收相关概念">垃圾回收相关概念</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/desinMode/" title="分类于 desinMode">desinMode</a></div><span><a href="/designMode/%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F/" title="中介者模式">中介者模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/springboot/" title="分类于 springboot">springboot</a></div><span><a href="/springboot/FactoryBean%20%E5%92%8C%20BeanFactory/" title="FactoryBean 和 BeanFactory">FactoryBean 和 BeanFactory</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 java">java</a></div><span><a href="/java/%E6%97%B6%E9%97%B4%E7%B1%BB/" title="Java 时间类">Java 时间类</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/data-structure/" title="分类于 数据结构">数据结构</a> <i class="ic i-angle-right"></i> <a href="/categories/data-structure/tree/" title="分类于 树">树</a></div><span><a href="/data_structure/binarySearchTree/" title="二叉搜索树">二叉搜索树</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/algorithm/" title="分类于 algorithm">algorithm</a></div><span><a href="/algorithm/%E5%88%86%E6%B2%BB%E6%B3%95/" title="分治法">分治法</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/MySQL/" title="分类于 MySQL">MySQL</a></div><span><a href="/mysql/MySQL8.0%20JSON%20%E6%93%8D%E4%BD%9C/" title="MySQL8.0 JSON 操作">MySQL8.0 JSON 操作</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 java">java</a></div><span><a href="/java/Lambda%20%E8%A1%A8%E8%BE%BE%E5%BC%8F/" title="Lambda 表达式">Lambda 表达式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/springboot/" title="分类于 springboot">springboot</a></div><span><a href="/springboot/Spring%20Value%20%E6%B3%A8%E8%A7%A3%E5%8A%A8%E6%80%81%E5%88%B7%E6%96%B0/" title="Spring Value 注解动态刷新">Spring Value 注解动态刷新</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/desinMode/" title="分类于 desinMode">desinMode</a></div><span><a href="/designMode/%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/" title="桥接模式">桥接模式</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">xiaou @ xiaou</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">488k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">7:23</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"JVM/字符串常量池/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,copy_tex:!0,katex:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//fastly.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->