<!-- build time:Mon Oct 17 2022 10:22:21 GMT+0000 (Coordinated Universal Time) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="xiaou博客" href="https://blog.xiaou.icu/rss.xml"><link rel="alternate" type="application/atom+xml" title="xiaou博客" href="https://blog.xiaou.icu/atom.xml"><link rel="alternate" type="application/json" title="xiaou博客" href="https://blog.xiaou.icu/feed.json"><link rel="stylesheet" href="//fonts.lug.ustc.edu.cn/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="java"><link rel="canonical" href="https://blog.xiaou.icu/JVM/%E6%96%B9%E6%B3%95%E5%8C%BA/"><title>方法区 - JVM | xiaou = xiaou博客</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">方法区</h1><div class="meta"><span class="item" title="创建时间：2022-01-26 14:43:28"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-01-26T14:43:28+08:00">2022-01-26</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>18k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>17 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">xiaou</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://s6.jpg.cm/2022/03/14/L2sU0f.jpg"></li><li class="item" data-background-image="https://s6.jpg.cm/2022/03/14/L2rFcQ.jpg"></li><li class="item" data-background-image="https://s6.jpg.cm/2022/03/14/L2rkvh.png"></li><li class="item" data-background-image="https://s6.jpg.cm/2022/03/14/L2rbvu.jpg"></li><li class="item" data-background-image="https://s6.jpg.cm/2022/03/14/L2E13D.jpg"></li><li class="item" data-background-image="https://s6.jpg.cm/2022/03/14/L2sI6G.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/JVM/" itemprop="item" rel="index" title="分类于 JVM"><span itemprop="name">JVM</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://blog.xiaou.icu/JVM/%E6%96%B9%E6%B3%95%E5%8C%BA/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="xiaou"><meta itemprop="description" content=", xiaou博客"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="xiaou博客"></span><div class="body md" itemprop="articleBody"><h1 id="方法区"><a class="anchor" href="#方法区">#</a> 方法区</h1><h2 id="栈-堆-方法区的交互关系"><a class="anchor" href="#栈-堆-方法区的交互关系">#</a> 栈、堆、方法区的交互关系</h2><p><strong>ThreadLocal</strong>：如何保证多个线程在并发环境下的安全性？典型场景就是数据库连接管理，以及会话管理。</p><p><img data-src="https://fastly.jsdelivr.net/gh/xiaou66/picture@master/image/1646537530135image-20220126150038980.png" alt="image-20220126150038980"></p><h3 id="对象的访问定位"><a class="anchor" href="#对象的访问定位">#</a> 对象的访问定位</h3><ol><li>Person 类的 .class 信息存放在方法区中</li><li>person 变量存放在 Java 栈的局部变量表中</li><li>真正的 person 对象存放在 Java 堆中</li><li>在 person 对象中，有个指针指向方法区中的 person 类型数据，表明这个 person 对象是用方法区中的 Person 类 new 出来的</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 方法区 java 栈      java 堆</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><img data-src="https://fastly.jsdelivr.net/gh/xiaou66/picture@master/image/1646537534143image-20220126151026872.png" alt="image-20220126151026872"></p><h2 id="方法区介绍"><a class="anchor" href="#方法区介绍">#</a> 方法区介绍</h2><h3 id="方法区在哪里"><a class="anchor" href="#方法区在哪里">#</a> 方法区在哪里？</h3><ol><li>《Java 虚拟机规范》中明确说明：尽管所有的方法区在逻辑上是属于堆的一部分，但一些简单的实现可能不会选择去进行垃圾收集或者进行压缩。但对于 <code>HotSpotJVM</code> 而言，方法区还有一个别名叫做 <code>Non-Heap</code> （非堆），目的就是要和堆分开。</li><li><strong>方法区可以看作是一块独立于 Java 堆的内存空间</strong></li></ol><p><img data-src="https://fastly.jsdelivr.net/gh/xiaou66/picture@master/image/1646537536142image-20220126151227338.png" alt="image-20220126151227338"></p><h3 id="方法区的基本理解"><a class="anchor" href="#方法区的基本理解">#</a> 方法区的基本理解</h3><p><strong>方法区主要存放的是 Class，而堆中主要存放的是实例化的对象</strong></p><ol><li>方法区（Method Area）与 Java 堆一样，是各个线程共享的内存区域。多个线程同时加载统一个类时，只能有一个线程能加载该类，其他线程只能等等待该线程加载完毕，然后直接使用该类，即类只能加载一次。</li><li>方法区在 JVM 启动的时候被创建，并且它的实际的物理内存空间中和 Java 堆区一样都可以是不连续的。</li><li>方法区的大小，跟堆空间一样，可以选择固定大小或者可扩展。</li><li>方法区的大小决定了系统可以保存多少个类，如果系统定义了太多的类，导致方法区溢出，虚拟机同样会抛出内存溢出错误： <code>java.lang.OutofMemoryError:PermGen space</code> 或者 <code>java.lang.OutOfMemoryError:Metaspace</code><ul><li>加载大量的第三方的 jar 包</li><li>Tomcat 部署的工程过多（30~50 个）</li><li>大量动态的生成反射类</li></ul></li><li>关闭 JVM 就会释放这个区域的内存。</li></ol><p><strong>代码举例</strong></p><pre><code class="language-JAVA">public class MethodAreaDemo &#123;
    public static void main(String[] args) &#123;
        System.out.println(&quot;start...&quot;);
        try &#123;
            Thread.sleep(1000000);
        &#125; catch (InterruptedException e) &#123;
            e.printStackTrace();
        &#125;
        System.out.println(&quot;end...&quot;);
    &#125;
&#125;
</code></pre><p><img data-src="https://fastly.jsdelivr.net/gh/xiaou66/picture@master/image/1646537540139image-20220126152034619.png" alt="image-20220126152034619"></p><h3 id="hotspot方法区演进"><a class="anchor" href="#hotspot方法区演进">#</a> HotSpot 方法区演进</h3><ol><li>在 JDK7 及以前，习惯上把方法区，称为永久代。JDK8 开始，使用元空间取代了永久代。我们可以将方法区类比为 Java 中的接口，将永久代或元空间类比为 Java 中具体的实现类</li><li>本质上，方法区和永久代并不等价。仅是对 Hotspot 而言的可以看作等价。《Java 虚拟机规范》对如何实现方法区，不做统一要求。例如：BEAJRockit / IBM J9 中不存在永久代的概念。<ul><li>现在来看，当年使用永久代，不是好的 idea。导致 Java 程序更容易 OOM（超过 <code>-XX:MaxPermsize</code> 上限）</li></ul></li><li>而到了 JDK8，终于 <strong>完全废弃了永久代</strong> 的概念，改用与 JRockit、J9 一样在本地内存中实现的 ** 元空间（Metaspace）** 来代替</li><li>元空间的本质和永久代类似，都是对 JVM 规范中方法区的实现。不过元空间与永久代最大的区别在于：<strong>元空间不在虚拟机设置的内存中，而是使用本地内存</strong>。</li><li>永久代、元空间二者并不只是名字变了，内部结构也调整了</li><li>根据《Java 虚拟机规范》的规定，如果方法区无法满足新的内存分配需求时，将抛出 OOM 异常</li></ol><h2 id="设置方法区大小与-oom"><a class="anchor" href="#设置方法区大小与-oom">#</a> 设置方法区大小与 OOM</h2><p>方法区的大小不必是固定的，JVM 可以根据应用的需要动态调整。</p><h3 id="jdk7及以前永久代"><a class="anchor" href="#jdk7及以前永久代">#</a> JDK7 及以前 (永久代)</h3><ol><li>通过 <code>-XX:Permsize</code> 来设置永久代初始分配空间。默认值是 20.75M</li><li><code>-XX:MaxPermsize</code> 来设定永久代最大可分配空间。32 位机器默认是 64M，64 位机器模式是 82M</li><li>当 JVM 加载的类信息容量超过了这个值，会报异常 <code>OutofMemoryError:PermGen space</code> 。</li></ol><h3 id="jdk8及以后元空间"><a class="anchor" href="#jdk8及以后元空间">#</a> JDK8 及以后 (元空间)</h3><ol><li>元数据区大小可以使用参数 <strong><code>-XX:MetaspaceSize</code> </strong>和 <strong><code>-XX:MaxMetaspaceSize</code> </strong>指定</li><li>默认值依赖于平台，Windows 下， <code>-XX:MetaspaceSize</code> 约为 21M， <code>-XX:MaxMetaspaceSize</code> 的值是 -1，即没有限制。</li><li>与永久代不同，如果不指定大小，默认情况下，虚拟机会耗尽所有的可用系统内存。如果元数据区发生溢出，虚拟机一样会抛出异常 <code>OutOfMemoryError:Metaspace</code></li><li><code>-XX:MetaspaceSize</code> ：设置初始的元空间大小。对于一个 64 位 的服务器端 JVM 来说，其默认的 <code>-XX:MetaspaceSize</code> 值为 21MB 。这就是初始的高水位线，一旦触及这个水位线，Full GC 将会被触发并卸载没用的类（即这些类对应的类加载器不再存活），然后这个高水位线将会重置。新的高水位线的值取决于 GC 后释放了多少元空间。如果释放的空间不足，那么在不超过 MaxMetaspaceSize 时，适当提高该值。如果释放空间过多，则适当降低该值。</li><li>如果初始化的高水位线设置过低，上述高水位线调整情况会发生很多次。通过垃圾回收器的日志可以观察到 Full GC 多次调用。为了避免频繁地 GC，建议将 <code>-XX:MetaspaceSize</code> 设置为一个相对较高的值。</li></ol><h3 id="方法区oom"><a class="anchor" href="#方法区oom">#</a> 方法区 OOM</h3><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OOMTest</span> <span class="token keyword">extends</span> <span class="token class-name">ClassLoader</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            <span class="token class-name">OOMTest</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OOMTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                <span class="token comment">// 创建 ClassWriter 对象，用于生成类的二进制字节码</span></pre></td></tr><tr><td data-num="8"></td><td><pre>                <span class="token class-name">ClassWriter</span> classWriter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassWriter</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>                <span class="token comment">// 指明版本号，修饰符，类名，包名，父类，接口</span></pre></td></tr><tr><td data-num="10"></td><td><pre>                classWriter<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">Opcodes</span><span class="token punctuation">.</span><span class="token constant">V1_8</span><span class="token punctuation">,</span> <span class="token class-name">Opcodes</span><span class="token punctuation">.</span><span class="token constant">ACC_PUBLIC</span><span class="token punctuation">,</span> <span class="token string">"Class"</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">"java/lang/Object"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                <span class="token comment">// 返回 byte []</span></pre></td></tr><tr><td data-num="12"></td><td><pre>                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> code <span class="token operator">=</span> classWriter<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                <span class="token comment">// 类的加载</span></pre></td></tr><tr><td data-num="14"></td><td><pre>                test<span class="token punctuation">.</span><span class="token function">defineClass</span><span class="token punctuation">(</span><span class="token string">"Class"</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> code<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> code<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Class 对象</span></pre></td></tr><tr><td data-num="15"></td><td><pre>                j<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>设置元空间的上限</strong></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// java8 Jvm Options </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token class-name">MetaspaceSize</span><span class="token operator">=</span><span class="token number">10</span>m <span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token class-name">MaxMetaspaceSize</span><span class="token operator">=</span><span class="token number">10</span>m</pre></td></tr></table></figure><p><strong>结果</strong></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">Exception</span> in thread <span class="token string">"main"</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>OutOfMemoryError</span><span class="token operator">:</span> <span class="token class-name">Compressed</span> <span class="token keyword">class</span> space</pre></td></tr><tr><td data-num="2"></td><td><pre>	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>ClassLoader</span><span class="token punctuation">.</span><span class="token function">defineClass1</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>ClassLoader</span><span class="token punctuation">.</span><span class="token function">defineClass</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">756</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>ClassLoader</span><span class="token punctuation">.</span><span class="token function">defineClass</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">635</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>xiaou<span class="token punctuation">.</span>day04<span class="token punctuation">.</span></span>OOMTest</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">OOMTest</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">27</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">3331</span></pre></td></tr></table></figure><h3 id="如何解决-oom"><a class="anchor" href="#如何解决-oom">#</a> 如何解决 OOM</h3><ol><li>要解决 OOM 异常或 heap space 的异常，一般的手段是首先通过内存映像分析工具（如 Ec1ipse Memory Analyzer）对 dump 出来的堆转储快照进行分析，重点是确认内存中的对象是否是必要的，也就是要先分清楚到底是出现了内存泄漏（Memory Leak）还是内存溢出（Memory Overflow）</li><li><strong>内存泄漏</strong> 就是有大量的引用指向某些对象，但是这些对象以后不会使用了，但是因为它们还和 GC ROOT 有关联，所以导致以后这些对象也不会被回收，这就是内存泄漏的问题</li><li>如果是内存泄漏，可进一步通过工具查看泄漏对象到 GC Roots 的引用链。于是就能找到泄漏对象是通过怎样的路径与 GC Roots 相关联并导致垃圾收集器无法自动回收它们的。掌握了泄漏对象的类型信息，以及 GC Roots 引用链的信息，就可以比较准确地定位出泄漏代码的位置。</li><li>如果不存在内存泄漏，换句话说就是内存中的对象确实都还必须存活着，那就应当检查虚拟机的堆参数（ <code>-Xmx</code> 与 <code>-Xms</code> ），与机器物理内存对比看是否还可以调大，从代码上检查是否存在某些对象生命周期过长、持有状态时间过长的情况，尝试减少程序运行期的内存消耗。</li></ol><h2 id="方法区的内部结构"><a class="anchor" href="#方法区的内部结构">#</a> 方法区的内部结构</h2><h3 id="方法区存储什么"><a class="anchor" href="#方法区存储什么">#</a> 方法区存储什么？</h3><h4 id="概念"><a class="anchor" href="#概念">#</a> 概念</h4><p>《深入理解 Java 虚拟机》书中对方法区（Method Area）存储内容描述如下：它用于存储已被虚拟机加载的类型信息、常量、静态变量、即时编译器编译后的代码缓存等。</p><p><img data-src="https://fastly.jsdelivr.net/gh/xiaou66/picture@master/image/1646537546141image-20220126162427863.png" alt="image-20220126162427863"></p><h3 id="类型信息"><a class="anchor" href="#类型信息">#</a> <strong>类型信息</strong></h3><p>对每个加载的类型（类 class、接口 interface、枚举 enum、注解 annotation），JVM 必须在方法区中存储以下类型信息：</p><ol><li>这个类型的完整有效名称（全名 = 包名。类名）</li><li>这个类型直接父类的完整有效名（对于 interface 或是 java.lang.Object，都没有父类）</li><li>这个类型的修饰符（public，abstract，final 的某个子集）</li><li>这个类型直接接口的一个有序列表</li></ol><h3 id="域field信息"><a class="anchor" href="#域field信息">#</a> <strong>域（Field）信息</strong></h3><ol><li>JVM 必须在方法区中保存类型的所有域的相关信息以及域的声明顺序。</li><li>域的相关信息包括：域名称，域类型，域修饰符（public，private，protected，static，final，volatile，transient 的某个子集）</li></ol><h3 id="方法method信息"><a class="anchor" href="#方法method信息">#</a> 方法（Method）信息</h3><p>JVM 必须保存所有方法的以下信息，同域信息一样包括声明顺序：</p><ol><li>方法名称</li><li>方法的返回类型（包括 void 返回类型），void 在 Java 中对应的为 void.class</li><li>方法参数的数量和类型（按顺序）</li><li>方法的修饰符（public，private，protected，static，final，synchronized，native，abstract 的一个子集）</li><li>方法的字节码（bytecodes）、操作数栈、局部变量表及大小（abstract 和 native 方法除外）</li><li>异常表（abstract 和 native 方法除外），异常表记录每个异常处理的开始位置、结束位置、代码处理在程序计数器中的偏移地址、被捕获的异常类的常量池索引</li></ol><h3 id="案例"><a class="anchor" href="#案例">#</a> 案例</h3><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MethodInnerStrucTest</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span> <span class="token keyword">implements</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// 属性</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">"测试方法的内部结构"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">// 构造器</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">// 方法</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"count = "</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token keyword">int</span> cal<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            result <span class="token operator">=</span> value <span class="token operator">/</span> cal<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token keyword">return</span> result<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name">String</span> o<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="字节码"><a class="anchor" href="#字节码">#</a> 字节码</h4><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>xiaou<span class="token punctuation">.</span>day04<span class="token punctuation">.</span></span>MethodInnerStrucTest</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Object</span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  minor version<span class="token operator">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  major version<span class="token operator">:</span> <span class="token number">52</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  flags<span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span><span class="token punctuation">,</span> <span class="token constant">ACC_SUPER</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token class-name">Constant</span> pool<span class="token operator">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>   #<span class="token number">1</span> <span class="token operator">=</span> <span class="token class-name">Methodref</span>          #<span class="token number">18.</span>#<span class="token number">52</span>        <span class="token comment">// java/lang/Object."&lt;init>":()V</span></pre></td></tr><tr><td data-num="7"></td><td><pre>   #<span class="token number">2</span> <span class="token operator">=</span> <span class="token class-name">Fieldref</span>           #<span class="token number">17.</span>#<span class="token number">53</span>        <span class="token comment">// com/xiaou/day04/MethodInnerStrucTest.num:I</span></pre></td></tr><tr><td data-num="8"></td><td><pre>   #<span class="token number">3</span> <span class="token operator">=</span> <span class="token class-name">Fieldref</span>           #<span class="token number">54.</span>#<span class="token number">55</span>        <span class="token comment">// java/lang/System.out:Ljava/io/PrintStream;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>   #<span class="token number">4</span> <span class="token operator">=</span> <span class="token class-name">Class</span>              #<span class="token number">56</span>            <span class="token comment">// java/lang/StringBuilder</span></pre></td></tr><tr><td data-num="10"></td><td><pre>   #<span class="token number">5</span> <span class="token operator">=</span> <span class="token class-name">Methodref</span>          #<span class="token number">4.</span>#<span class="token number">52</span>         <span class="token comment">// java/lang/StringBuilder."&lt;init>":()V</span></pre></td></tr><tr><td data-num="11"></td><td><pre>   #<span class="token number">6</span> <span class="token operator">=</span> <span class="token class-name">String</span>             #<span class="token number">57</span>            <span class="token comment">// count =</span></pre></td></tr><tr><td data-num="12"></td><td><pre>   #<span class="token number">7</span> <span class="token operator">=</span> <span class="token class-name">Methodref</span>          #<span class="token number">4.</span>#<span class="token number">58</span>         <span class="token comment">// java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>   #<span class="token number">8</span> <span class="token operator">=</span> <span class="token class-name">Methodref</span>          #<span class="token number">4.</span>#<span class="token number">59</span>         <span class="token comment">// java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>   #<span class="token number">9</span> <span class="token operator">=</span> <span class="token class-name">Methodref</span>          #<span class="token number">4.</span>#<span class="token number">60</span>         <span class="token comment">// java/lang/StringBuilder.toString:()Ljava/lang/String;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  #<span class="token number">10</span> <span class="token operator">=</span> <span class="token class-name">Methodref</span>          #<span class="token number">61.</span>#<span class="token number">62</span>        <span class="token comment">// java/io/PrintStream.println:(Ljava/lang/String;)V</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  #<span class="token number">11</span> <span class="token operator">=</span> <span class="token class-name">Class</span>              #<span class="token number">63</span>            <span class="token comment">// java/lang/Exception</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  #<span class="token number">12</span> <span class="token operator">=</span> <span class="token class-name">Methodref</span>          #<span class="token number">11.</span>#<span class="token number">64</span>        <span class="token comment">// java/lang/Exception.printStackTrace:()V</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  #<span class="token number">13</span> <span class="token operator">=</span> <span class="token class-name">Class</span>              #<span class="token number">65</span>            <span class="token comment">// java/lang/String</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  #<span class="token number">14</span> <span class="token operator">=</span> <span class="token class-name">Methodref</span>          #<span class="token number">17.</span>#<span class="token number">66</span>        <span class="token comment">// com/xiaou/day04/MethodInnerStrucTest.compareTo:(Ljava/lang/String;)I</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  #<span class="token number">15</span> <span class="token operator">=</span> <span class="token class-name">String</span>             #<span class="token number">67</span>            <span class="token comment">// 测试方法的内部结构</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  #<span class="token number">16</span> <span class="token operator">=</span> <span class="token class-name">Fieldref</span>           #<span class="token number">17.</span>#<span class="token number">68</span>        <span class="token comment">// com/xiaou/day04/MethodInnerStrucTest.str:Ljava/lang/String;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  #<span class="token number">17</span> <span class="token operator">=</span> <span class="token class-name">Class</span>              #<span class="token number">69</span>            <span class="token comment">// com/xiaou/day04/MethodInnerStrucTest</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  #<span class="token number">18</span> <span class="token operator">=</span> <span class="token class-name">Class</span>              #<span class="token number">70</span>            <span class="token comment">// java/lang/Object</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  #<span class="token number">19</span> <span class="token operator">=</span> <span class="token class-name">Class</span>              #<span class="token number">71</span>            <span class="token comment">// java/lang/Comparable</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  #<span class="token number">20</span> <span class="token operator">=</span> <span class="token class-name">Class</span>              #<span class="token number">72</span>            <span class="token comment">// java/io/Serializable</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  #<span class="token number">21</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               num</pre></td></tr><tr><td data-num="27"></td><td><pre>  #<span class="token number">22</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">I</span></pre></td></tr><tr><td data-num="28"></td><td><pre>  #<span class="token number">23</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               str</pre></td></tr><tr><td data-num="29"></td><td><pre>  #<span class="token number">24</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>  #<span class="token number">25</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="31"></td><td><pre>  #<span class="token number">26</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span></pre></td></tr><tr><td data-num="32"></td><td><pre>  #<span class="token number">27</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">Code</span></pre></td></tr><tr><td data-num="33"></td><td><pre>  #<span class="token number">28</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">LineNumberTable</span></pre></td></tr><tr><td data-num="34"></td><td><pre>  #<span class="token number">29</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">LocalVariableTable</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  #<span class="token number">30</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token keyword">this</span></pre></td></tr><tr><td data-num="36"></td><td><pre>  #<span class="token number">31</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">Lcom</span><span class="token operator">/</span>xiaou<span class="token operator">/</span>day04<span class="token operator">/</span><span class="token class-name">MethodInnerStrucTest</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>  #<span class="token number">32</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               test1</pre></td></tr><tr><td data-num="38"></td><td><pre>  #<span class="token number">33</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               count</pre></td></tr><tr><td data-num="39"></td><td><pre>  #<span class="token number">34</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               test2</pre></td></tr><tr><td data-num="40"></td><td><pre>  #<span class="token number">35</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token punctuation">(</span><span class="token class-name">I</span><span class="token punctuation">)</span><span class="token class-name">I</span></pre></td></tr><tr><td data-num="41"></td><td><pre>  #<span class="token number">36</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               value</pre></td></tr><tr><td data-num="42"></td><td><pre>  #<span class="token number">37</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               e</pre></td></tr><tr><td data-num="43"></td><td><pre>  #<span class="token number">38</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Exception</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>  #<span class="token number">39</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               cal</pre></td></tr><tr><td data-num="45"></td><td><pre>  #<span class="token number">40</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               result</pre></td></tr><tr><td data-num="46"></td><td><pre>  #<span class="token number">41</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">StackMapTable</span></pre></td></tr><tr><td data-num="47"></td><td><pre>  #<span class="token number">42</span> <span class="token operator">=</span> <span class="token class-name">Class</span>              #<span class="token number">63</span>            <span class="token comment">// java/lang/Exception</span></pre></td></tr><tr><td data-num="48"></td><td><pre>  #<span class="token number">43</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               compareTo</pre></td></tr><tr><td data-num="49"></td><td><pre>  #<span class="token number">44</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">I</span></pre></td></tr><tr><td data-num="50"></td><td><pre>  #<span class="token number">45</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               o</pre></td></tr><tr><td data-num="51"></td><td><pre>  #<span class="token number">46</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Object</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">I</span></pre></td></tr><tr><td data-num="52"></td><td><pre>  #<span class="token number">47</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token generics"><span class="token punctuation">&lt;</span>clinit<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="53"></td><td><pre>  #<span class="token number">48</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">Signature</span></pre></td></tr><tr><td data-num="54"></td><td><pre>  #<span class="token number">49</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Object</span><span class="token punctuation">;</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Comparable</span><span class="token operator">&lt;</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token operator">></span><span class="token punctuation">;</span><span class="token class-name">Ljava</span><span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">Serializable</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>  #<span class="token number">50</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">SourceFile</span></pre></td></tr><tr><td data-num="56"></td><td><pre>  #<span class="token number">51</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">MethodInnerStrucTest</span><span class="token punctuation">.</span>java</pre></td></tr><tr><td data-num="57"></td><td><pre>  #<span class="token number">52</span> <span class="token operator">=</span> <span class="token class-name">NameAndType</span>        #<span class="token number">25</span><span class="token operator">:</span>#<span class="token number">26</span>        <span class="token comment">// "&lt;init>":()V</span></pre></td></tr><tr><td data-num="58"></td><td><pre>  #<span class="token number">53</span> <span class="token operator">=</span> <span class="token class-name">NameAndType</span>        #<span class="token number">21</span><span class="token operator">:</span>#<span class="token number">22</span>        <span class="token comment">// num:I</span></pre></td></tr><tr><td data-num="59"></td><td><pre>  #<span class="token number">54</span> <span class="token operator">=</span> <span class="token class-name">Class</span>              #<span class="token number">73</span>            <span class="token comment">// java/lang/System</span></pre></td></tr><tr><td data-num="60"></td><td><pre>  #<span class="token number">55</span> <span class="token operator">=</span> <span class="token class-name">NameAndType</span>        #<span class="token number">74</span><span class="token operator">:</span>#<span class="token number">75</span>        <span class="token comment">// out:Ljava/io/PrintStream;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>  #<span class="token number">56</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span></pre></td></tr><tr><td data-num="62"></td><td><pre>  #<span class="token number">57</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               count <span class="token operator">=</span></pre></td></tr><tr><td data-num="63"></td><td><pre>  #<span class="token number">58</span> <span class="token operator">=</span> <span class="token class-name">NameAndType</span>        #<span class="token number">76</span><span class="token operator">:</span>#<span class="token number">77</span>        <span class="token comment">// append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>  #<span class="token number">59</span> <span class="token operator">=</span> <span class="token class-name">NameAndType</span>        #<span class="token number">76</span><span class="token operator">:</span>#<span class="token number">78</span>        <span class="token comment">// append:(I)Ljava/lang/StringBuilder;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>  #<span class="token number">60</span> <span class="token operator">=</span> <span class="token class-name">NameAndType</span>        #<span class="token number">79</span><span class="token operator">:</span>#<span class="token number">80</span>        <span class="token comment">// toString:()Ljava/lang/String;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>  #<span class="token number">61</span> <span class="token operator">=</span> <span class="token class-name">Class</span>              #<span class="token number">81</span>            <span class="token comment">// java/io/PrintStream</span></pre></td></tr><tr><td data-num="67"></td><td><pre>  #<span class="token number">62</span> <span class="token operator">=</span> <span class="token class-name">NameAndType</span>        #<span class="token number">82</span><span class="token operator">:</span>#<span class="token number">83</span>        <span class="token comment">// println:(Ljava/lang/String;)V</span></pre></td></tr><tr><td data-num="68"></td><td><pre>  #<span class="token number">63</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Exception</span></pre></td></tr><tr><td data-num="69"></td><td><pre>  #<span class="token number">64</span> <span class="token operator">=</span> <span class="token class-name">NameAndType</span>        #<span class="token number">84</span><span class="token operator">:</span>#<span class="token number">26</span>        <span class="token comment">// printStackTrace:()V</span></pre></td></tr><tr><td data-num="70"></td><td><pre>  #<span class="token number">65</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span></pre></td></tr><tr><td data-num="71"></td><td><pre>  #<span class="token number">66</span> <span class="token operator">=</span> <span class="token class-name">NameAndType</span>        #<span class="token number">43</span><span class="token operator">:</span>#<span class="token number">44</span>        <span class="token comment">// compareTo:(Ljava/lang/String;)I</span></pre></td></tr><tr><td data-num="72"></td><td><pre>  #<span class="token number">67</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               测试方法的内部结构</pre></td></tr><tr><td data-num="73"></td><td><pre>  #<span class="token number">68</span> <span class="token operator">=</span> <span class="token class-name">NameAndType</span>        #<span class="token number">23</span><span class="token operator">:</span>#<span class="token number">24</span>        <span class="token comment">// str:Ljava/lang/String;</span></pre></td></tr><tr><td data-num="74"></td><td><pre>  #<span class="token number">69</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               com<span class="token operator">/</span>xiaou<span class="token operator">/</span>day04<span class="token operator">/</span><span class="token class-name">MethodInnerStrucTest</span></pre></td></tr><tr><td data-num="75"></td><td><pre>  #<span class="token number">70</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Object</span></pre></td></tr><tr><td data-num="76"></td><td><pre>  #<span class="token number">71</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Comparable</span></pre></td></tr><tr><td data-num="77"></td><td><pre>  #<span class="token number">72</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">Serializable</span></pre></td></tr><tr><td data-num="78"></td><td><pre>  #<span class="token number">73</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">System</span></pre></td></tr><tr><td data-num="79"></td><td><pre>  #<span class="token number">74</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               out</pre></td></tr><tr><td data-num="80"></td><td><pre>  #<span class="token number">75</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token class-name">Ljava</span><span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="81"></td><td><pre>  #<span class="token number">76</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               append</pre></td></tr><tr><td data-num="82"></td><td><pre>  #<span class="token number">77</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="83"></td><td><pre>  #<span class="token number">78</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token punctuation">(</span><span class="token class-name">I</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="84"></td><td><pre>  #<span class="token number">79</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               toString</pre></td></tr><tr><td data-num="85"></td><td><pre>  #<span class="token number">80</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="86"></td><td><pre>  #<span class="token number">81</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span></pre></td></tr><tr><td data-num="87"></td><td><pre>  #<span class="token number">82</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               println</pre></td></tr><tr><td data-num="88"></td><td><pre>  #<span class="token number">83</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span></pre></td></tr><tr><td data-num="89"></td><td><pre>  #<span class="token number">84</span> <span class="token operator">=</span> <span class="token class-name">Utf8</span>               printStackTrace</pre></td></tr><tr><td data-num="90"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="91"></td><td><pre>  <span class="token keyword">public</span> <span class="token keyword">int</span> num<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="92"></td><td><pre>    descriptor<span class="token operator">:</span> <span class="token class-name">I</span></pre></td></tr><tr><td data-num="93"></td><td><pre>    flags<span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span></pre></td></tr><tr><td data-num="94"></td><td><pre></pre></td></tr><tr><td data-num="95"></td><td><pre>  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span> str<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="96"></td><td><pre>    descriptor<span class="token operator">:</span> <span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="97"></td><td><pre>    flags<span class="token operator">:</span> <span class="token constant">ACC_PRIVATE</span><span class="token punctuation">,</span> <span class="token constant">ACC_STATIC</span></pre></td></tr><tr><td data-num="98"></td><td><pre></pre></td></tr><tr><td data-num="99"></td><td><pre>  <span class="token keyword">public</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>xiaou<span class="token punctuation">.</span>day04<span class="token punctuation">.</span></span>MethodInnerStrucTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="100"></td><td><pre>    descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span></pre></td></tr><tr><td data-num="101"></td><td><pre>    flags<span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span></pre></td></tr><tr><td data-num="102"></td><td><pre>    <span class="token class-name">Code</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="103"></td><td><pre>      stack<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">1</span></pre></td></tr><tr><td data-num="104"></td><td><pre>         <span class="token number">0</span><span class="token operator">:</span> aload_0</pre></td></tr><tr><td data-num="105"></td><td><pre>         <span class="token number">1</span><span class="token operator">:</span> invokespecial #<span class="token number">1</span>                  <span class="token comment">// Method java/lang/Object."&lt;init>":()V</span></pre></td></tr><tr><td data-num="106"></td><td><pre>         <span class="token number">4</span><span class="token operator">:</span> aload_0</pre></td></tr><tr><td data-num="107"></td><td><pre>         <span class="token number">5</span><span class="token operator">:</span> bipush        <span class="token number">10</span></pre></td></tr><tr><td data-num="108"></td><td><pre>         <span class="token number">7</span><span class="token operator">:</span> putfield      #<span class="token number">2</span>                  <span class="token comment">// Field num:I</span></pre></td></tr><tr><td data-num="109"></td><td><pre>        <span class="token number">10</span><span class="token operator">:</span> <span class="token keyword">return</span></pre></td></tr><tr><td data-num="110"></td><td><pre>      <span class="token class-name">LineNumberTable</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="111"></td><td><pre>        line <span class="token number">6</span><span class="token operator">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="112"></td><td><pre>        line <span class="token number">8</span><span class="token operator">:</span> <span class="token number">4</span></pre></td></tr><tr><td data-num="113"></td><td><pre>      <span class="token class-name">LocalVariableTable</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="114"></td><td><pre>        <span class="token class-name">Start</span>  <span class="token class-name">Length</span>  <span class="token class-name">Slot</span>  <span class="token class-name">Name</span>   <span class="token class-name">Signature</span></pre></td></tr><tr><td data-num="115"></td><td><pre>            <span class="token number">0</span>      <span class="token number">11</span>     <span class="token number">0</span>  <span class="token keyword">this</span>   <span class="token class-name">Lcom</span><span class="token operator">/</span>xiaou<span class="token operator">/</span>day04<span class="token operator">/</span><span class="token class-name">MethodInnerStrucTest</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="116"></td><td><pre></pre></td></tr><tr><td data-num="117"></td><td><pre>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="118"></td><td><pre>    descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span></pre></td></tr><tr><td data-num="119"></td><td><pre>    flags<span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span></pre></td></tr><tr><td data-num="120"></td><td><pre>    <span class="token class-name">Code</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="121"></td><td><pre>      stack<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">1</span></pre></td></tr><tr><td data-num="122"></td><td><pre>         <span class="token number">0</span><span class="token operator">:</span> bipush        <span class="token number">20</span></pre></td></tr><tr><td data-num="123"></td><td><pre>         <span class="token number">2</span><span class="token operator">:</span> istore_1</pre></td></tr><tr><td data-num="124"></td><td><pre>         <span class="token number">3</span><span class="token operator">:</span> getstatic     #<span class="token number">3</span>                  <span class="token comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></pre></td></tr><tr><td data-num="125"></td><td><pre>         <span class="token number">6</span><span class="token operator">:</span> <span class="token keyword">new</span>           #<span class="token number">4</span>                  <span class="token comment">// class java/lang/StringBuilder</span></pre></td></tr><tr><td data-num="126"></td><td><pre>         <span class="token number">9</span><span class="token operator">:</span> dup</pre></td></tr><tr><td data-num="127"></td><td><pre>        <span class="token number">10</span><span class="token operator">:</span> invokespecial #<span class="token number">5</span>                  <span class="token comment">// Method java/lang/StringBuilder."&lt;init>":()V</span></pre></td></tr><tr><td data-num="128"></td><td><pre>        <span class="token number">13</span><span class="token operator">:</span> ldc           #<span class="token number">6</span>                  <span class="token comment">// String count =</span></pre></td></tr><tr><td data-num="129"></td><td><pre>        <span class="token number">15</span><span class="token operator">:</span> invokevirtual #<span class="token number">7</span>                  <span class="token comment">// Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span></pre></td></tr><tr><td data-num="130"></td><td><pre>        <span class="token number">18</span><span class="token operator">:</span> iload_1</pre></td></tr><tr><td data-num="131"></td><td><pre>        <span class="token number">19</span><span class="token operator">:</span> invokevirtual #<span class="token number">8</span>                  <span class="token comment">// Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;</span></pre></td></tr><tr><td data-num="132"></td><td><pre>        <span class="token number">22</span><span class="token operator">:</span> invokevirtual #<span class="token number">9</span>                  <span class="token comment">// Method java/lang/StringBuilder.toString:()Ljava/lang/String;</span></pre></td></tr><tr><td data-num="133"></td><td><pre>        <span class="token number">25</span><span class="token operator">:</span> invokevirtual #<span class="token number">10</span>                 <span class="token comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></pre></td></tr><tr><td data-num="134"></td><td><pre>        <span class="token number">28</span><span class="token operator">:</span> <span class="token keyword">return</span></pre></td></tr><tr><td data-num="135"></td><td><pre>      <span class="token class-name">LineNumberTable</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="136"></td><td><pre>        line <span class="token number">13</span><span class="token operator">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="137"></td><td><pre>        line <span class="token number">14</span><span class="token operator">:</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="138"></td><td><pre>        line <span class="token number">15</span><span class="token operator">:</span> <span class="token number">28</span></pre></td></tr><tr><td data-num="139"></td><td><pre>      <span class="token class-name">LocalVariableTable</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="140"></td><td><pre>        <span class="token class-name">Start</span>  <span class="token class-name">Length</span>  <span class="token class-name">Slot</span>  <span class="token class-name">Name</span>   <span class="token class-name">Signature</span></pre></td></tr><tr><td data-num="141"></td><td><pre>            <span class="token number">0</span>      <span class="token number">29</span>     <span class="token number">0</span>  <span class="token keyword">this</span>   <span class="token class-name">Lcom</span><span class="token operator">/</span>xiaou<span class="token operator">/</span>day04<span class="token operator">/</span><span class="token class-name">MethodInnerStrucTest</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="142"></td><td><pre>            <span class="token number">3</span>      <span class="token number">26</span>     <span class="token number">1</span> count   <span class="token class-name">I</span></pre></td></tr><tr><td data-num="143"></td><td><pre></pre></td></tr><tr><td data-num="144"></td><td><pre>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="145"></td><td><pre>    descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">I</span><span class="token punctuation">)</span><span class="token class-name">I</span></pre></td></tr><tr><td data-num="146"></td><td><pre>    flags<span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span><span class="token punctuation">,</span> <span class="token constant">ACC_STATIC</span></pre></td></tr><tr><td data-num="147"></td><td><pre>    <span class="token class-name">Code</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="148"></td><td><pre>      stack<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">1</span></pre></td></tr><tr><td data-num="149"></td><td><pre>         <span class="token number">0</span><span class="token operator">:</span> iconst_0</pre></td></tr><tr><td data-num="150"></td><td><pre>         <span class="token number">1</span><span class="token operator">:</span> istore_1</pre></td></tr><tr><td data-num="151"></td><td><pre>         <span class="token number">2</span><span class="token operator">:</span> bipush        <span class="token number">30</span></pre></td></tr><tr><td data-num="152"></td><td><pre>         <span class="token number">4</span><span class="token operator">:</span> istore_2</pre></td></tr><tr><td data-num="153"></td><td><pre>         <span class="token number">5</span><span class="token operator">:</span> iload_2</pre></td></tr><tr><td data-num="154"></td><td><pre>         <span class="token number">6</span><span class="token operator">:</span> iload_0</pre></td></tr><tr><td data-num="155"></td><td><pre>         <span class="token number">7</span><span class="token operator">:</span> idiv</pre></td></tr><tr><td data-num="156"></td><td><pre>         <span class="token number">8</span><span class="token operator">:</span> istore_1</pre></td></tr><tr><td data-num="157"></td><td><pre>         <span class="token number">9</span><span class="token operator">:</span> <span class="token keyword">goto</span>          <span class="token number">17</span></pre></td></tr><tr><td data-num="158"></td><td><pre>        <span class="token number">12</span><span class="token operator">:</span> astore_2</pre></td></tr><tr><td data-num="159"></td><td><pre>        <span class="token number">13</span><span class="token operator">:</span> aload_2</pre></td></tr><tr><td data-num="160"></td><td><pre>        <span class="token number">14</span><span class="token operator">:</span> invokevirtual #<span class="token number">12</span>                 <span class="token comment">// Method java/lang/Exception.printStackTrace:()V</span></pre></td></tr><tr><td data-num="161"></td><td><pre>        <span class="token number">17</span><span class="token operator">:</span> iload_1</pre></td></tr><tr><td data-num="162"></td><td><pre>        <span class="token number">18</span><span class="token operator">:</span> ireturn</pre></td></tr><tr><td data-num="163"></td><td><pre>      <span class="token class-name">Exception</span> table<span class="token operator">:</span></pre></td></tr><tr><td data-num="164"></td><td><pre>         from    <span class="token keyword">to</span>  <span class="token namespace">target</span> type</pre></td></tr><tr><td data-num="165"></td><td><pre>             <span class="token number">2</span>     <span class="token number">9</span>    <span class="token number">12</span>   <span class="token class-name">Class</span> java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Exception</span></pre></td></tr><tr><td data-num="166"></td><td><pre>      <span class="token class-name">LineNumberTable</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="167"></td><td><pre>        line <span class="token number">17</span><span class="token operator">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="168"></td><td><pre>        line <span class="token number">19</span><span class="token operator">:</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="169"></td><td><pre>        line <span class="token number">20</span><span class="token operator">:</span> <span class="token number">5</span></pre></td></tr><tr><td data-num="170"></td><td><pre>        line <span class="token number">23</span><span class="token operator">:</span> <span class="token number">9</span></pre></td></tr><tr><td data-num="171"></td><td><pre>        line <span class="token number">21</span><span class="token operator">:</span> <span class="token number">12</span></pre></td></tr><tr><td data-num="172"></td><td><pre>        line <span class="token number">22</span><span class="token operator">:</span> <span class="token number">13</span></pre></td></tr><tr><td data-num="173"></td><td><pre>        line <span class="token number">24</span><span class="token operator">:</span> <span class="token number">17</span></pre></td></tr><tr><td data-num="174"></td><td><pre>      <span class="token class-name">LocalVariableTable</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="175"></td><td><pre>        <span class="token class-name">Start</span>  <span class="token class-name">Length</span>  <span class="token class-name">Slot</span>  <span class="token class-name">Name</span>   <span class="token class-name">Signature</span></pre></td></tr><tr><td data-num="176"></td><td><pre>            <span class="token number">5</span>       <span class="token number">4</span>     <span class="token number">2</span> value   <span class="token class-name">I</span></pre></td></tr><tr><td data-num="177"></td><td><pre>           <span class="token number">13</span>       <span class="token number">4</span>     <span class="token number">2</span>     e   <span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Exception</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="178"></td><td><pre>            <span class="token number">0</span>      <span class="token number">19</span>     <span class="token number">0</span>   cal   <span class="token class-name">I</span></pre></td></tr><tr><td data-num="179"></td><td><pre>            <span class="token number">2</span>      <span class="token number">17</span>     <span class="token number">1</span> result   <span class="token class-name">I</span></pre></td></tr><tr><td data-num="180"></td><td><pre>      <span class="token class-name">StackMapTable</span><span class="token operator">:</span> number_of_entries <span class="token operator">=</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="181"></td><td><pre>        frame_type <span class="token operator">=</span> <span class="token number">255</span> <span class="token comment">/* full_frame */</span></pre></td></tr><tr><td data-num="182"></td><td><pre>          offset_delta <span class="token operator">=</span> <span class="token number">12</span></pre></td></tr><tr><td data-num="183"></td><td><pre>          locals <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="184"></td><td><pre>          stack <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token keyword">class</span> java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Exception</span> <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="185"></td><td><pre>        frame_type <span class="token operator">=</span> <span class="token number">4</span> <span class="token comment">/* same */</span></pre></td></tr><tr><td data-num="186"></td><td><pre></pre></td></tr><tr><td data-num="187"></td><td><pre>  <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="188"></td><td><pre>    descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">I</span></pre></td></tr><tr><td data-num="189"></td><td><pre>    flags<span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span></pre></td></tr><tr><td data-num="190"></td><td><pre>    <span class="token class-name">Code</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="191"></td><td><pre>      stack<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">2</span></pre></td></tr><tr><td data-num="192"></td><td><pre>         <span class="token number">0</span><span class="token operator">:</span> iconst_0</pre></td></tr><tr><td data-num="193"></td><td><pre>         <span class="token number">1</span><span class="token operator">:</span> ireturn</pre></td></tr><tr><td data-num="194"></td><td><pre>      <span class="token class-name">LineNumberTable</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="195"></td><td><pre>        line <span class="token number">29</span><span class="token operator">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="196"></td><td><pre>      <span class="token class-name">LocalVariableTable</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="197"></td><td><pre>        <span class="token class-name">Start</span>  <span class="token class-name">Length</span>  <span class="token class-name">Slot</span>  <span class="token class-name">Name</span>   <span class="token class-name">Signature</span></pre></td></tr><tr><td data-num="198"></td><td><pre>            <span class="token number">0</span>       <span class="token number">2</span>     <span class="token number">0</span>  <span class="token keyword">this</span>   <span class="token class-name">Lcom</span><span class="token operator">/</span>xiaou<span class="token operator">/</span>day04<span class="token operator">/</span><span class="token class-name">MethodInnerStrucTest</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="199"></td><td><pre>            <span class="token number">0</span>       <span class="token number">2</span>     <span class="token number">1</span>     o   <span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="200"></td><td><pre></pre></td></tr><tr><td data-num="201"></td><td><pre>  <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Object</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="202"></td><td><pre>    descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Object</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">I</span></pre></td></tr><tr><td data-num="203"></td><td><pre>    flags<span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span><span class="token punctuation">,</span> <span class="token constant">ACC_BRIDGE</span><span class="token punctuation">,</span> <span class="token constant">ACC_SYNTHETIC</span></pre></td></tr><tr><td data-num="204"></td><td><pre>    <span class="token class-name">Code</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="205"></td><td><pre>      stack<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">2</span></pre></td></tr><tr><td data-num="206"></td><td><pre>         <span class="token number">0</span><span class="token operator">:</span> aload_0</pre></td></tr><tr><td data-num="207"></td><td><pre>         <span class="token number">1</span><span class="token operator">:</span> aload_1</pre></td></tr><tr><td data-num="208"></td><td><pre>         <span class="token number">2</span><span class="token operator">:</span> checkcast     #<span class="token number">13</span>                 <span class="token comment">// class java/lang/String</span></pre></td></tr><tr><td data-num="209"></td><td><pre>         <span class="token number">5</span><span class="token operator">:</span> invokevirtual #<span class="token number">14</span>                 <span class="token comment">// Method compareTo:(Ljava/lang/String;)I</span></pre></td></tr><tr><td data-num="210"></td><td><pre>         <span class="token number">8</span><span class="token operator">:</span> ireturn</pre></td></tr><tr><td data-num="211"></td><td><pre>      <span class="token class-name">LineNumberTable</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="212"></td><td><pre>        line <span class="token number">6</span><span class="token operator">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="213"></td><td><pre>      <span class="token class-name">LocalVariableTable</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="214"></td><td><pre>        <span class="token class-name">Start</span>  <span class="token class-name">Length</span>  <span class="token class-name">Slot</span>  <span class="token class-name">Name</span>   <span class="token class-name">Signature</span></pre></td></tr><tr><td data-num="215"></td><td><pre>            <span class="token number">0</span>       <span class="token number">9</span>     <span class="token number">0</span>  <span class="token keyword">this</span>   <span class="token class-name">Lcom</span><span class="token operator">/</span>xiaou<span class="token operator">/</span>day04<span class="token operator">/</span><span class="token class-name">MethodInnerStrucTest</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="216"></td><td><pre></pre></td></tr><tr><td data-num="217"></td><td><pre>  <span class="token keyword">static</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="218"></td><td><pre>    descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span></pre></td></tr><tr><td data-num="219"></td><td><pre>    flags<span class="token operator">:</span> <span class="token constant">ACC_STATIC</span></pre></td></tr><tr><td data-num="220"></td><td><pre>    <span class="token class-name">Code</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="221"></td><td><pre>      stack<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">0</span></pre></td></tr><tr><td data-num="222"></td><td><pre>         <span class="token number">0</span><span class="token operator">:</span> ldc           #<span class="token number">15</span>                 <span class="token comment">// String 测试方法的内部结构</span></pre></td></tr><tr><td data-num="223"></td><td><pre>         <span class="token number">2</span><span class="token operator">:</span> putstatic     #<span class="token number">16</span>                 <span class="token comment">// Field str:Ljava/lang/String;</span></pre></td></tr><tr><td data-num="224"></td><td><pre>         <span class="token number">5</span><span class="token operator">:</span> <span class="token keyword">return</span></pre></td></tr><tr><td data-num="225"></td><td><pre>      <span class="token class-name">LineNumberTable</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="226"></td><td><pre>        line <span class="token number">9</span><span class="token operator">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="227"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="类型信息-2"><a class="anchor" href="#类型信息-2">#</a> 类型信息</h4><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 类型信息      </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>xiaou<span class="token punctuation">.</span>day04<span class="token punctuation">.</span></span>MethodInnerStrucTest</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Object</span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span></pre></td></tr></table></figure><h4 id="域信息"><a class="anchor" href="#域信息">#</a> 域信息</h4><ol><li>descriptor: I 表示字段类型为 Integer</li><li>flags: ACC_PUBLIC 表示字段权限修饰符为 public</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">int</span> num<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    descriptor<span class="token operator">:</span> <span class="token class-name">I</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    flags<span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span> str<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    descriptor<span class="token operator">:</span> <span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    flags<span class="token operator">:</span> <span class="token constant">ACC_PRIVATE</span><span class="token punctuation">,</span> <span class="token constant">ACC_STATIC</span></pre></td></tr></table></figure><h4 id="方法信息"><a class="anchor" href="#方法信息">#</a> 方法信息</h4><ol><li>descriptor: () V 表示方法返回值类型为 void</li><li>flags: ACC_PUBLIC 表示方法权限修饰符为 public</li><li>stack=3 表示操作数栈深度为 3</li><li>locals=2 表示局部变量个数为 2 个（实力方法包含 this）</li><li>test1 () 方法虽然没有参数，但是其 args_size=1 ，这时因为将 this 作为了参数</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    flags<span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">Code</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>      stack<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">1</span></pre></td></tr><tr><td data-num="6"></td><td><pre>         <span class="token number">0</span><span class="token operator">:</span> bipush        <span class="token number">20</span></pre></td></tr><tr><td data-num="7"></td><td><pre>         <span class="token number">2</span><span class="token operator">:</span> istore_1</pre></td></tr><tr><td data-num="8"></td><td><pre>         <span class="token number">3</span><span class="token operator">:</span> getstatic     #<span class="token number">3</span>                  <span class="token comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>         <span class="token number">6</span><span class="token operator">:</span> <span class="token keyword">new</span>           #<span class="token number">4</span>                  <span class="token comment">// class java/lang/StringBuilder</span></pre></td></tr><tr><td data-num="10"></td><td><pre>         <span class="token number">9</span><span class="token operator">:</span> dup</pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token number">10</span><span class="token operator">:</span> invokespecial #<span class="token number">5</span>                  <span class="token comment">// Method java/lang/StringBuilder."&lt;init>":()V</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token number">13</span><span class="token operator">:</span> ldc           #<span class="token number">6</span>                  <span class="token comment">// String count =</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token number">15</span><span class="token operator">:</span> invokevirtual #<span class="token number">7</span>                  <span class="token comment">// Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token number">18</span><span class="token operator">:</span> iload_1</pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token number">19</span><span class="token operator">:</span> invokevirtual #<span class="token number">8</span>                  <span class="token comment">// Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token number">22</span><span class="token operator">:</span> invokevirtual #<span class="token number">9</span>                  <span class="token comment">// Method java/lang/StringBuilder.toString:()Ljava/lang/String;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token number">25</span><span class="token operator">:</span> invokevirtual #<span class="token number">10</span>                 <span class="token comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token number">28</span><span class="token operator">:</span> <span class="token keyword">return</span></pre></td></tr><tr><td data-num="19"></td><td><pre>      <span class="token class-name">LineNumberTable</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        line <span class="token number">13</span><span class="token operator">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        line <span class="token number">14</span><span class="token operator">:</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        line <span class="token number">15</span><span class="token operator">:</span> <span class="token number">28</span></pre></td></tr><tr><td data-num="23"></td><td><pre>      <span class="token class-name">LocalVariableTable</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token class-name">Start</span>  <span class="token class-name">Length</span>  <span class="token class-name">Slot</span>  <span class="token class-name">Name</span>   <span class="token class-name">Signature</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            <span class="token number">0</span>      <span class="token number">29</span>     <span class="token number">0</span>  <span class="token keyword">this</span>   <span class="token class-name">Lcom</span><span class="token operator">/</span>xiaou<span class="token operator">/</span>day04<span class="token operator">/</span><span class="token class-name">MethodInnerStrucTest</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            <span class="token number">3</span>      <span class="token number">26</span>     <span class="token number">1</span> count   <span class="token class-name">I</span></pre></td></tr></table></figure><h3 id="non-final-类型的类变量"><a class="anchor" href="#non-final-类型的类变量">#</a> non-final 类型的类变量</h3><ol><li>静态变量和类关联在一起，随着类的加载而加载，他们成为类数据在逻辑上的一部分</li><li>类变量被类的所有实例共享，即使没有类实例时，你也可以访问它</li></ol><pre><code class="language-JAVA">public class MethodAreaTest &#123;
    public static void main(String[] args) &#123;
        Order order = null;
        order.hello();
        System.out.println(order.count);
    &#125;
&#125;

class Order &#123;
    public static int count = 1;
    public static final int number = 2;


    public static void hello() &#123;
        System.out.println(&quot;hello!&quot;);
    &#125;
&#125;
</code></pre><p><strong>结果</strong></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>hello<span class="token operator">!</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">1</span></pre></td></tr></table></figure><h3 id="全局常量static-final"><a class="anchor" href="#全局常量static-final">#</a> 全局常量：static final</h3><ol><li>全局常量就是使用 static final 进行修饰</li><li>被声明为 final 的类变量的处理方法则不同，每个全局常量在编译的时候就会被分配了。</li></ol><p>查看上面代码，这部分的字节码指令</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Order</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> count<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    descriptor<span class="token operator">:</span> <span class="token class-name">I</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    flags<span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span><span class="token punctuation">,</span> <span class="token constant">ACC_STATIC</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> number<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    descriptor<span class="token operator">:</span> <span class="token class-name">I</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    flags<span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span><span class="token punctuation">,</span> <span class="token constant">ACC_STATIC</span><span class="token punctuation">,</span> <span class="token constant">ACC_FINAL</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token class-name">ConstantValue</span><span class="token operator">:</span> <span class="token keyword">int</span> <span class="token number">2</span></pre></td></tr></table></figure><p>可以发现 staitc 和 final 同时修饰的 number 的值在编译上的时候已经写死在字节码文件中了。</p><h2 id="运行时常量池"><a class="anchor" href="#运行时常量池">#</a> 运行时常量池</h2><h3 id="运行时常量池-vs-常量池"><a class="anchor" href="#运行时常量池-vs-常量池">#</a> 运行时常量池 VS 常量池</h3><ol><li>方法区，内部包含了运行时常量池</li><li>字节码文件，内部包含了常量池。（之前的字节码文件中已经看到了很多 Constant pool 的东西，这个就是常量池）</li><li>要弄清楚方法区，需要理解清楚 ClassFile，因为加载类的信息都在方法区。</li><li>要弄清楚方法区的运行时常量池，需要理解清楚 ClassFile 中的常量池。</li></ol><h3 id="常量池"><a class="anchor" href="#常量池">#</a> 常量池</h3><ol><li>一个有效的字节码文件中除了包含类的版本信息、字段、方法以及接口等描述符信息外。还包含一项信息就是 <strong>常量池表</strong>（<strong>Constant Pool Table</strong>），包括各种字面量和对类型、域和方法的符号引用。</li><li>字面量： 10 ， “我是某某” 这种数字和字符串都是字面量</li></ol><h4 id="为什么需要常量池"><a class="anchor" href="#为什么需要常量池">#</a> <strong>为什么需要常量池？</strong></h4><ol><li>一个 java 源文件中的类、接口，编译后产生一个字节码文件。而 Java 中的字节码需要数据支持，通常这种数据会很大以至于不能直接存到字节码里，换另一种方式，可以存到常量池。这个字节码包含了指向常量池的引用。在动态链接的时候会用到运行时常量池。</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleClass</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol><li>虽然上述代码只有 194 字节，但是里面却使用了 String、System、PrintStream 及 Object 等结构。</li><li>比如说我们这个文件中有 6 个地方用到了 &quot;hello&quot; 这个字符串，如果不用常量池，就需要在 6 个地方全写一遍，造成臃肿。我们可以将 &quot;hello&quot; 等所需用到的结构信息记录在常量池中，并通过 ** 引用的方式 **，来加载、调用所需的结构</li><li>这里的代码量其实很少了，如果代码多的话，引用的结构将会更多，这里就需要用到常量池了。</li></ol><p><strong>常量池中有啥</strong></p><ol><li>数量值</li><li>字符串值</li><li>类引用</li><li>字段引用</li><li>方法引用</li></ol><p><strong>MethodInnerStrucTest 的 test1 方法的字节码</strong></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">0</span> bipush <span class="token number">20</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token number">2</span> istore_1</pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token number">3</span> getstatic #<span class="token number">3</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">></span></pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token number">6</span> <span class="token keyword">new</span> #<span class="token number">4</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token number">9</span> dup</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">10</span> invokespecial #<span class="token number">5</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">></span></span><span class="token operator">></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">13</span> ldc #<span class="token number">6</span> <span class="token operator">&lt;</span>count <span class="token operator">=</span> <span class="token operator">></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">15</span> invokevirtual #<span class="token number">7</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">.</span>append<span class="token operator">></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">18</span> iload_1</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">19</span> invokevirtual #<span class="token number">8</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">.</span>append<span class="token operator">></span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">22</span> invokevirtual #<span class="token number">9</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">.</span>toString<span class="token operator">></span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token number">25</span> invokevirtual #<span class="token number">10</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">.</span>println<span class="token operator">></span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token number">28</span> <span class="token keyword">return</span></pre></td></tr></table></figure><blockquote><p>#3，#5 等等这些带# 的，都是引用了常量池。</p></blockquote><h4 id="常量池总结"><a class="anchor" href="#常量池总结">#</a> 常量池总结</h4><p>常量池、可以看做是一张表，虚拟机指令根据这张常量表找到要执行的类名、方法名、参数类型、字面量等类型。</p><h3 id="运行时常量池-2"><a class="anchor" href="#运行时常量池-2">#</a> 运行时常量池</h3><ol><li>运行时常量池（Runtime Constant Pool）是<strong>方法区</strong>的一部分。</li><li>常量池表（Constant Pool Table）是 Class 字节码文件的一部分，用于存放编译期生成的各种字面量与符号引用，<strong>这部分内容将在类加载后存放到方法区的运行时常量池中</strong>。（运行时常量池就是常量池在程序运行时的称呼）</li><li>运行时常量池，在加载类和接口到虚拟机后，就会创建对应的运行时常量池。</li><li>JVM 为每个已加载的类型（类或接口）都维护一个常量池。池中的数据项像数组项一样，是通过索引访问的。</li><li>运行时常量池中包含多种不同的常量，包括编译期就已经明确的数值字面量，也包括到运行期解析后才能够获得的方法或者字段引用。<strong>此时不再是常量池中的符号地址了，这里换为真实地址</strong>。<ul><li>运行时常量池，相对于 Class 文件常量池的另一重要特征是：具备动态性。</li></ul></li><li>运行时常量池类似于传统编程语言中的符号表（symbol table），但是它所包含的数据却比符号表要更加丰富一些。</li><li>当创建类或接口的运行时常量池时，如果构造运行时常量池所需的内存空间超过了方法区所能提供的最大值，则 JVM 会抛 <code>OutofMemoryError</code> 异常。</li></ol><h4 id="举例"><a class="anchor" href="#举例">#</a> <strong>举例</strong></h4><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MethodAreaDemo</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">int</span> a <span class="token operator">=</span> x <span class="token operator">/</span> y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="字节码-2"><a class="anchor" href="#字节码-2">#</a> <strong>字节码</strong></h4><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">0</span> sipush <span class="token number">500</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token number">3</span> istore_1</pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token number">4</span> bipush <span class="token number">100</span></pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token number">6</span> istore_2</pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token number">7</span> iload_1</pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token number">8</span> iload_2</pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token number">9</span> idiv</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">10</span> istore_3</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">11</span> bipush <span class="token number">50</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">13</span> istore <span class="token number">4</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">15</span> getstatic #<span class="token number">2</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">System</span><span class="token punctuation">.</span>out <span class="token operator">:</span> <span class="token class-name">Ljava</span><span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token number">18</span> iload_3</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token number">19</span> iload <span class="token number">4</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token number">21</span> iadd</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">22</span> invokevirtual #<span class="token number">3</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">.</span>println <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">I</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">></span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token number">25</span> <span class="token keyword">return</span></pre></td></tr></table></figure><h4 id="图解"><a class="anchor" href="#图解">#</a> <strong>图解</strong></h4><p><img data-src="https://fastly.jsdelivr.net/gh/xiaou66/picture@master/image/1646537556141image-20220127134350788.png" alt="image-20220127134350788"></p><p><img data-src="https://fastly.jsdelivr.net/gh/xiaou66/picture@master/image/1646537558136image-20220127134805355.png" alt="image-20220127134805355"></p><p><img data-src="https://fastly.jsdelivr.net/gh/xiaou66/picture@master/image/1646537568143image-20220127135027040.png" alt="image-20220127135027040"></p><p><img data-src="https://fastly.jsdelivr.net/gh/xiaou66/picture@master/image/1646537572137image-20220127135046123.png" alt="image-20220127135046123"></p><p><img data-src="https://fastly.jsdelivr.net/gh/xiaou66/picture@master/image/1646537576143image-20220127135149303.png" alt="image-20220127135149303"></p><p><img data-src="https://fastly.jsdelivr.net/gh/xiaou66/picture@master/image/1646537578132image-20220127135201119.png" alt="image-20220127135201119"></p><p><img data-src="https://fastly.jsdelivr.net/gh/xiaou66/picture@master/image/1646537582144image-20220127135211896.png" alt="image-20220127135211896"></p><p><img data-src="https://fastly.jsdelivr.net/gh/xiaou66/picture@master/image/1646537586139image-20220127135223144.png" alt="image-20220127135223144"></p><p><img data-src="https://fastly.jsdelivr.net/gh/xiaou66/picture@master/image/1646537590130image-20220127135238803.png" alt="image-20220127135238803"></p><p><img data-src="https://fastly.jsdelivr.net/gh/xiaou66/picture@master/image/1646537594141image-20220127135414660.png" alt="image-20220127135414660"></p><p><img data-src="https://fastly.jsdelivr.net/gh/xiaou66/picture@master/image/1646537598139image-20220127135434413.png" alt="image-20220127135434413"></p><p><img data-src="https://fastly.jsdelivr.net/gh/xiaou66/picture@master/image/1646537602130image-20220127135447126.png" alt="image-20220127135447126"></p><p><img data-src="https://fastly.jsdelivr.net/gh/xiaou66/picture@master/image/1646537606171image-20220127135627613.png" alt="image-20220127135627613"></p><h2 id="方法区演进细节"><a class="anchor" href="#方法区演进细节">#</a> 方法区演进细节</h2><h3 id="永久代演进过程"><a class="anchor" href="#永久代演进过程">#</a> 永久代演进过程</h3><ol><li>首先明确：只有 Hotspot 才有永久代。BEA JRockit、IBMJ9 等来说，是不存在永久代的概念的。原则上如何实现方法区属于虚拟机实现细节，不受《Java 虚拟机规范》管束，并不要求统一。</li><li>Hotspot 中方法区的变化：</li></ol><table><thead><tr><th>JDK1.6 及以前</th><th>有永久代（permanent generation），静态变量存储在永久代上</th></tr></thead><tbody><tr><td>JDK1.7</td><td>有永久代，但已经逐步 “去永久代”，<strong>字符串常量池，静态变量移除，保存在堆中</strong></td></tr><tr><td>JDK1.8</td><td>无永久代，类型信息，字段，方法，常量保存在本地内存的元空间，但字符串常量池、静态变量仍然在堆中。</td></tr></tbody></table><h3 id="jdk-6"><a class="anchor" href="#jdk-6">#</a> JDK 6</h3><p><img data-src="https://fastly.jsdelivr.net/gh/xiaou66/picture@master/image/1646537612144image-20220127142003181.png" alt="image-20220127142003181"></p><h3 id="jdk-7"><a class="anchor" href="#jdk-7">#</a> JDK 7</h3><p><img data-src="https://fastly.jsdelivr.net/gh/xiaou66/picture@master/image/1646537614144image-20220127141934717.png" alt="image-20220127141934717"></p><h3 id="jdk-8"><a class="anchor" href="#jdk-8">#</a> JDK 8</h3><p><img data-src="D:%5Ccode%5Cxiaou_blog%5Csource_posts%5CdesignMode%5Cimage%5Cimage-20220127141945990.png" alt="image-20220127141945990"></p><h3 id="永久代为什么要被元空间替代"><a class="anchor" href="#永久代为什么要被元空间替代">#</a> 永久代为什么要被元空间替代？</h3><ol><li><p>随着 Java8 的到来，HotSpot VM 中再也见不到永久代了。但是这并不意味着类的元数据信息也消失了。这些数据被移到了一个与堆不相连的本地内存区域，这个区域叫做元空间（Metaspace）。</p></li><li><p>由于类的元数据分配在本地内存中，元空间的最大可分配空间就是系统可用内存空间。</p></li><li><p>这项改动是很有必要的，原因有：</p><ol><li><p>为永久代设置空间大小是很难确定的。在某些场景下，如果动态加载类过多，容易产生 Perm 区的 OOM。比如某个实际 Web 工程中，因为功能点比较多，在运行过程中，要不断动态加载很多类，经常出现致命错误。 <code>Exception in thread 'dubbo client x.x connector' java.lang.OutOfMemoryError:PermGen space</code> 而元空间和永久代之间最大的区别在于：元空间并不在虚拟机中，而是使用本地内存。 因此，默认情况下，元空间的大小仅受本地内存限制。</p></li><li><p>对永久代进行调优是很困难的。方法区的垃圾收集主要回收两部分内容：常量池中废弃的常量和不再用的类型，方法区的调优主要是为了降低 <strong>Full GC</strong></p><ol><li>有些人认为方法区（如 HotSpot 虚拟机中的元空间或者永久代）是没有垃圾收集行为的，其实不然。《Java 虚拟机规范》对方法区的约束是非常宽松的，提到过可以不要求虚拟机在方法区中实现垃圾收集。事实上也确实有未实现或未能完整实现方法区类型卸载的收集器存在（如 JDK11 时期的 ZGC 收集器就不支持类卸载）。</li></ol></li></ol></li><li><p>一般来说这个区域的回收效果比较难令人满意，尤其是<strong>类型的卸载，条件相当苛刻</strong>。但是这部分区域的回收有时又确实是必要的。以前 Sun 公司的 Bug 列表中，曾出现过的若干个严重的 Bug 就是由于低版本的 HotSpot 虚拟机对此区域未完全回收而导致内存泄漏。</p></li></ol><h3 id="字符串常量池"><a class="anchor" href="#字符串常量池">#</a> 字符串常量池</h3><p><strong>字符串常量池 StringTable 为什么要调整位置？</strong></p><ul><li>JDK7 中将 StringTable 放到了堆空间中。因为永久代的回收效率很低，在 Full GC 的时候才会执行永久代的垃圾回收，而 Full GC 是老年代的空间不足、永久代不足时才会触发。</li><li>这就导致 StringTable 回收效率不高，而我们开发中会有大量的字符串被创建，回收效率低，导致永久代内存不足。放到堆里，能及时回收内存。</li></ul><h2 id="静态变量放在哪里"><a class="anchor" href="#静态变量放在哪里">#</a> 静态变量放在哪里</h2><h3 id="对象实体在哪里放着"><a class="anchor" href="#对象实体在哪里放着">#</a> 对象实体在哪里放着？</h3><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre> * 结论：</pre></td></tr><tr><td data-num="3"></td><td><pre> * 1、静态引用对应的对象实体 (也就是这个 new byte [1024 * 1024 * 100]) 始终都存在堆空间，</pre></td></tr><tr><td data-num="4"></td><td><pre> * 2、只是那个变量 (相当于下面的 arr 变量名) 在 JDK6,JDK7,JDK8 存放位置中有所变化</pre></td></tr><tr><td data-num="5"></td><td><pre> *</pre></td></tr><tr><td data-num="6"></td><td><pre> * jdk7：</pre></td></tr><tr><td data-num="7"></td><td><pre> * -Xms200m -Xmx200m -XX:PermSize=300m -XX:MaxPermSize=300m -XX:+PrintGCDetails</pre></td></tr><tr><td data-num="8"></td><td><pre> * jdk 8：</pre></td></tr><tr><td data-num="9"></td><td><pre> * -Xms200m -Xmx200m -XX:MetaspaceSize=300m -XX:MaxMetaspaceSize=300m -XX:+PrintGCDetails</pre></td></tr><tr><td data-num="10"></td><td><pre> */</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticFieldTest</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//100MB</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">StaticFieldTest</span><span class="token punctuation">.</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="方法区的垃圾回收"><a class="anchor" href="#方法区的垃圾回收">#</a> 方法区的垃圾回收</h2><ol><li><p>有些人认为方法区（如 Hotspot 虚拟机中的元空间或者永久代）是没有垃圾收集行为的，其实不然。《Java 虚拟机规范》对方法区的约束是非常宽松的，提到过可以不要求虚拟机在方法区中实现垃圾收集。事实上也确实有未实现或未能完整实现方法区 <strong>类型卸载</strong> 的收集器存在（如 JDK11 时期的 ZGC 收集器就不支持类卸载）。</p></li><li><p>一般来说这个区域的回收效果比较难令人满意，尤其是类型的卸载，条件相当苛刻。但是这部分区域的回收有时又确实是必要的。以前 sun 公司的 Bug 列表中，曾出现过的若干个严重的 Bug 就是由于低版本的 HotSpot 虚拟机对此区域未完全回收而导致内存泄漏。</p></li><li><p>方法区的垃圾收集主要回收两部分内容：<strong>常量池中废弃的常量和不再使用的类型</strong>。</p></li><li><p>方法区内常量池之中主要存放的两大类常量：<strong>字面量</strong> 和 <strong>符号引用</strong>。<strong>字面量</strong> 比较接近 Java 语言层次的常量概念，如文本字符串、被声明为 final 的常量值等。而 <strong>符号引用</strong> 则属于编译原理方面的概念，包括下面三类常量：</p><ol><li><p>类和接口的全限定名</p></li><li><p>字段的名称和描述符</p></li><li><p>方法的名称和描述符</p></li></ol></li><li><p>HotSpot 虚拟机对常量池的回收策略是很明确的，只要常量池中的常量没有被任何地方引用，就可以被回收。</p></li><li><p>回收废弃常量与回收 Java 堆中的对象非常类似。（关于常量的回收比较简单，重点是类的回收）</p></li></ol><p>下面也称作 <strong>类卸</strong>载</p><p>1、判定一个常量是否 “废弃” 还是相对简单，而要判定一个类型是否属于 “不再被使用的类” 的条件就比较苛刻了。需要同时满足下面三个条件：</p><ul><li>该类所有的实例都已经被回收，也就是 Java 堆中不存在该类及其任何派生子类的实例。</li><li>加载该类的类加载器已经被回收，这个条件除非是经过精心设计的可替换类加载器的场景，如 OSGi、JSP 的重加载等，否则通常是很难达成的。</li><li>该类对应的 java.lang.Class 对象没有在任何地方被引用，无法在任何地方通过反射访问该类的方法。</li></ul><p>2、Java 虚拟机被允许对满足上述三个条件的无用类进行回收，这里说的仅仅是 “被允许”，而并不是和对象一样，没有引用了就必然会回收。关于是否要对类型进行回收，HotSpot 虚拟机提供了 <code>-Xnoclassgc</code> 参数进行控制，还可以使用 <code>-verbose:class</code> 以及 <code>-XX：+TraceClass-Loading</code> 、 <code>-XX：+TraceClassUnLoading</code> 查看类加载和卸载信息</p><p>3、在大量使用反射、动态代理、CGLib 等字节码框架，动态生成 JSP 以及 OSGi 这类频繁自定义类加载器的场景中，通常都需要 Java 虚拟机具备类型卸载的能力，以保证不会对方法区造成过大的内存压力。</p><h2 id="直接内存"><a class="anchor" href="#直接内存">#</a> 直接内存</h2><h3 id="直接内存概述"><a class="anchor" href="#直接内存概述">#</a> 直接内存概述</h3><ol><li>不是虚拟机运行时数据区的一部分，也不是《Java 虚拟机规范》中定义的内存区域。</li><li>直接内存是在 Java 堆外的、直接向系统申请的内存区间。</li><li>来源于 NIO，通过存在堆中的 DirectByteBuffer 操作 Native 内存</li><li>通常，访问直接内存的速度会优于 Java 堆。即读写性能高。</li><li>因此出于性能考虑，读写频繁的场合可能会考虑使用直接内存。</li><li>Java 的 NIO 库允许 Java 程序使用直接内存，用于数据缓冲区</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BufferTest</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">BUFFER</span> <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span><span class="token comment">//1GB</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token comment">// 直接分配本地内存空间</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token class-name">ByteBuffer</span> byteBuffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocateDirect</span><span class="token punctuation">(</span><span class="token constant">BUFFER</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"直接内存分配完毕，请求指示！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        scanner<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"直接内存开始释放！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        byteBuffer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        scanner<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img data-src="https://fastly.jsdelivr.net/gh/xiaou66/picture@master/image/1646537620137image-20220127145706375.png" alt="image-20220127145706375"></p><h3 id="bio-与-nio"><a class="anchor" href="#bio-与-nio">#</a> BIO 与 NIO</h3><div class="note info"><ol><li><p>BIO 的架构，在读写本地文件时，我们需要从用户态切换成内核态</p></li><li><p>NIO 直接操作物理磁盘，省去了中间过程</p></li></ol></div><h3 id="直接内存与-oom"><a class="anchor" href="#直接内存与-oom">#</a> 直接内存与 OOM</h3><ol><li>直接内存也可能导致 OutofMemoryError 异常</li><li>由于直接内存在 Java 堆外，因此它的大小不会直接受限于 - Xmx 指定的最大堆大小，但是系统内存是有限的，Java 堆和直接内存的总和依然受限于操作系统能给出的最大内存。</li><li>直接内存的缺点为：<ul><li>分配回收成本较高</li><li>不受 JVM 内存回收管理</li></ul></li><li>直接内存大小可以通过 MaxDirectMemorySize 设置</li><li>如果不指定，默认与堆的最大值 -Xmx 参数值一致</li></ol><div class="tags"><a href="/tags/java/" rel="tag"><i class="ic i-tag"></i> java</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-10-17 18:21:27" itemprop="dateModified" datetime="2022-10-17T18:21:27+08:00">2022-10-17</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="xiaou 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="xiaou 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>xiaou <i class="ic i-at"><em>@</em></i>xiaou博客</li><li class="link"><strong>本文链接：</strong> <a href="https://blog.xiaou.icu/JVM/%E6%96%B9%E6%B3%95%E5%8C%BA/" title="方法区">https://blog.xiaou.icu/JVM/方法区/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/JVM/%E5%A0%86/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;s6.jpg.cm&#x2F;2022&#x2F;03&#x2F;14&#x2F;L2rfJf.png" title="堆"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> JVM</span><h3>堆</h3></a></div><div class="item right"><a href="/JVM/%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;s6.jpg.cm&#x2F;2022&#x2F;03&#x2F;14&#x2F;L2sN6i.jpg" title="执行引擎"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> JVM</span><h3>执行引擎</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%8C%BA"><span class="toc-number">1.</span> <span class="toc-text">方法区</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%88-%E5%A0%86-%E6%96%B9%E6%B3%95%E5%8C%BA%E7%9A%84%E4%BA%A4%E4%BA%92%E5%85%B3%E7%B3%BB"><span class="toc-number">1.1.</span> <span class="toc-text">栈、堆、方法区的交互关系</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%AE%BF%E9%97%AE%E5%AE%9A%E4%BD%8D"><span class="toc-number">1.1.1.</span> <span class="toc-text">对象的访问定位</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%8C%BA%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.2.</span> <span class="toc-text">方法区介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%8C%BA%E5%9C%A8%E5%93%AA%E9%87%8C"><span class="toc-number">1.2.1.</span> <span class="toc-text">方法区在哪里？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%8C%BA%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%90%86%E8%A7%A3"><span class="toc-number">1.2.2.</span> <span class="toc-text">方法区的基本理解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hotspot%E6%96%B9%E6%B3%95%E5%8C%BA%E6%BC%94%E8%BF%9B"><span class="toc-number">1.2.3.</span> <span class="toc-text">HotSpot 方法区演进</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%96%B9%E6%B3%95%E5%8C%BA%E5%A4%A7%E5%B0%8F%E4%B8%8E-oom"><span class="toc-number">1.3.</span> <span class="toc-text">设置方法区大小与 OOM</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#jdk7%E5%8F%8A%E4%BB%A5%E5%89%8D%E6%B0%B8%E4%B9%85%E4%BB%A3"><span class="toc-number">1.3.1.</span> <span class="toc-text">JDK7 及以前 (永久代)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jdk8%E5%8F%8A%E4%BB%A5%E5%90%8E%E5%85%83%E7%A9%BA%E9%97%B4"><span class="toc-number">1.3.2.</span> <span class="toc-text">JDK8 及以后 (元空间)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%8C%BAoom"><span class="toc-number">1.3.3.</span> <span class="toc-text">方法区 OOM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3-oom"><span class="toc-number">1.3.4.</span> <span class="toc-text">如何解决 OOM</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%8C%BA%E7%9A%84%E5%86%85%E9%83%A8%E7%BB%93%E6%9E%84"><span class="toc-number">1.4.</span> <span class="toc-text">方法区的内部结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%8C%BA%E5%AD%98%E5%82%A8%E4%BB%80%E4%B9%88"><span class="toc-number">1.4.1.</span> <span class="toc-text">方法区存储什么？</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">概念</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E4%BF%A1%E6%81%AF"><span class="toc-number">1.4.2.</span> <span class="toc-text">类型信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%9Ffield%E4%BF%A1%E6%81%AF"><span class="toc-number">1.4.3.</span> <span class="toc-text">域（Field）信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95method%E4%BF%A1%E6%81%AF"><span class="toc-number">1.4.4.</span> <span class="toc-text">方法（Method）信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-number">1.4.5.</span> <span class="toc-text">案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E8%8A%82%E7%A0%81"><span class="toc-number">1.4.5.1.</span> <span class="toc-text">字节码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E4%BF%A1%E6%81%AF-2"><span class="toc-number">1.4.5.2.</span> <span class="toc-text">类型信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%9F%E4%BF%A1%E6%81%AF"><span class="toc-number">1.4.5.3.</span> <span class="toc-text">域信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%BF%A1%E6%81%AF"><span class="toc-number">1.4.5.4.</span> <span class="toc-text">方法信息</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#non-final-%E7%B1%BB%E5%9E%8B%E7%9A%84%E7%B1%BB%E5%8F%98%E9%87%8F"><span class="toc-number">1.4.6.</span> <span class="toc-text">non-final 类型的类变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%B8%B8%E9%87%8Fstatic-final"><span class="toc-number">1.4.7.</span> <span class="toc-text">全局常量：static final</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E6%97%B6%E5%B8%B8%E9%87%8F%E6%B1%A0"><span class="toc-number">1.5.</span> <span class="toc-text">运行时常量池</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E6%97%B6%E5%B8%B8%E9%87%8F%E6%B1%A0-vs-%E5%B8%B8%E9%87%8F%E6%B1%A0"><span class="toc-number">1.5.1.</span> <span class="toc-text">运行时常量池 VS 常量池</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E9%87%8F%E6%B1%A0"><span class="toc-number">1.5.2.</span> <span class="toc-text">常量池</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%B8%B8%E9%87%8F%E6%B1%A0"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">为什么需要常量池？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E9%87%8F%E6%B1%A0%E6%80%BB%E7%BB%93"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">常量池总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E6%97%B6%E5%B8%B8%E9%87%8F%E6%B1%A0-2"><span class="toc-number">1.5.3.</span> <span class="toc-text">运行时常量池</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">举例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E8%8A%82%E7%A0%81-2"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">字节码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%BE%E8%A7%A3"><span class="toc-number">1.5.3.3.</span> <span class="toc-text">图解</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%8C%BA%E6%BC%94%E8%BF%9B%E7%BB%86%E8%8A%82"><span class="toc-number">1.6.</span> <span class="toc-text">方法区演进细节</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B0%B8%E4%B9%85%E4%BB%A3%E6%BC%94%E8%BF%9B%E8%BF%87%E7%A8%8B"><span class="toc-number">1.6.1.</span> <span class="toc-text">永久代演进过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jdk-6"><span class="toc-number">1.6.2.</span> <span class="toc-text">JDK 6</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jdk-7"><span class="toc-number">1.6.3.</span> <span class="toc-text">JDK 7</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jdk-8"><span class="toc-number">1.6.4.</span> <span class="toc-text">JDK 8</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B0%B8%E4%B9%85%E4%BB%A3%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E8%A2%AB%E5%85%83%E7%A9%BA%E9%97%B4%E6%9B%BF%E4%BB%A3"><span class="toc-number">1.6.5.</span> <span class="toc-text">永久代为什么要被元空间替代？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B8%B8%E9%87%8F%E6%B1%A0"><span class="toc-number">1.6.6.</span> <span class="toc-text">字符串常量池</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%8F%98%E9%87%8F%E6%94%BE%E5%9C%A8%E5%93%AA%E9%87%8C"><span class="toc-number">1.7.</span> <span class="toc-text">静态变量放在哪里</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E5%AE%9E%E4%BD%93%E5%9C%A8%E5%93%AA%E9%87%8C%E6%94%BE%E7%9D%80"><span class="toc-number">1.7.1.</span> <span class="toc-text">对象实体在哪里放着？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%8C%BA%E7%9A%84%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6"><span class="toc-number">1.8.</span> <span class="toc-text">方法区的垃圾回收</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98"><span class="toc-number">1.9.</span> <span class="toc-text">直接内存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98%E6%A6%82%E8%BF%B0"><span class="toc-number">1.9.1.</span> <span class="toc-text">直接内存概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bio-%E4%B8%8E-nio"><span class="toc-number">1.9.2.</span> <span class="toc-text">BIO 与 NIO</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98%E4%B8%8E-oom"><span class="toc-number">1.9.3.</span> <span class="toc-text">直接内存与 OOM</span></a></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/JVM/JVM%E5%92%8CJava%E4%BD%93%E7%B3%BB%E6%9E%B6%E6%9E%84/" rel="bookmark" title="JVM和Java体系架构">JVM和Java体系架构</a></li><li><a href="/JVM/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%AD%90%E7%B3%BB%E7%BB%9F/" rel="bookmark" title="类加载器子系统">类加载器子系统</a></li><li><a href="/JVM/%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA/" rel="bookmark" title="运行时数据区">运行时数据区</a></li><li><a href="/JVM/%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88/" rel="bookmark" title="虚拟机栈">虚拟机栈</a></li><li><a href="/JVM/%E5%A0%86/" rel="bookmark" title="堆">堆</a></li><li class="active"><a href="/JVM/%E6%96%B9%E6%B3%95%E5%8C%BA/" rel="bookmark" title="方法区">方法区</a></li><li><a href="/JVM/%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E/" rel="bookmark" title="执行引擎">执行引擎</a></li><li><a href="/JVM/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B8%B8%E9%87%8F%E6%B1%A0/" rel="bookmark" title="字符串常量池">字符串常量池</a></li><li><a href="/JVM/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%A6%82%E8%BF%B0%E5%92%8C%E7%9B%B8%E5%85%B3%E7%AE%97%E6%B3%95/" rel="bookmark" title="垃圾回收概述和相关算法">垃圾回收概述和相关算法</a></li><li><a href="/JVM/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5/" rel="bookmark" title="垃圾回收相关概念">垃圾回收相关概念</a></li><li><a href="/JVM/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8/" rel="bookmark" title="垃圾回收器">垃圾回收器</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="xiaou" data-src="/images/avatar.jpg"><p class="name" itemprop="name">xiaou</p><div class="description" itemprop="description">xiaou博客</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">85</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">16</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">7</span> <span class="name">标签</span></a></div></nav><div class="social"></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/JVM/%E5%A0%86/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/JVM/%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/data-structure/" title="分类于 数据结构">数据结构</a> <i class="ic i-angle-right"></i> <a href="/categories/data-structure/hashTable/" title="分类于 hashTable">hashTable</a></div><span><a href="/data_structure/HashTable/" title="红黑树">红黑树</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/data-structure/" title="分类于 数据结构">数据结构</a> <i class="ic i-angle-right"></i> <a href="/categories/data-structure/tree/" title="分类于 树">树</a></div><span><a href="/data_structure/tree/" title="树&amp;二叉树">树&二叉树</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/springboot/" title="分类于 springboot">springboot</a></div><span><a href="/springboot/Spring%20%E4%BA%8B%E4%BB%B6%E6%A8%A1%E5%BC%8F/" title="Spring 事件模式">Spring 事件模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/desinMode/" title="分类于 desinMode">desinMode</a></div><span><a href="/designMode/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/" title="代理模式">代理模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/data-structure/" title="分类于 数据结构">数据结构</a> <i class="ic i-angle-right"></i> <a href="/categories/data-structure/tree/" title="分类于 树">树</a></div><span><a href="/data_structure/RDTree/" title="红黑树">红黑树</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/desinMode/" title="分类于 desinMode">desinMode</a></div><span><a href="/designMode/%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F/" title="中介者模式">中介者模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/desinMode/" title="分类于 desinMode">desinMode</a></div><span><a href="/designMode/%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8F/" title="解释器模式">解释器模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/JVM/" title="分类于 JVM">JVM</a></div><span><a href="/JVM/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B8%B8%E9%87%8F%E6%B1%A0/" title="字符串常量池">字符串常量池</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/desinMode/" title="分类于 desinMode">desinMode</a></div><span><a href="/designMode/%E4%B8%83%E5%A4%A7%E5%8E%9F%E5%88%99/" title="七大原则">七大原则</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/MySql/" title="分类于 mysql">mysql</a></div><span><a href="/mysql/SQL%20%E4%B8%AD%E5%B0%86%E6%9D%A1%E4%BB%B6%E6%94%BE%E5%9C%A8%20on%20%E5%90%8E%E9%9D%A2%E4%B8%8E%20where%20%E5%90%8E%E9%9D%A2%E7%9A%84%E5%8C%BA%E5%88%AB/" title="SQL 中将条件放在 on 后面与 where 后面的区别">SQL 中将条件放在 on 后面与 where 后面的区别</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">xiaou @ xiaou</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">488k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">7:23</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"JVM/方法区/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,copy_tex:!0,katex:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//fastly.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->